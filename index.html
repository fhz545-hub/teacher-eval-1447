<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>استمارة دعم وتطوير الهيئة التعليمية (زيارة معلم) ١٤٤٧هـ</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&family=Cairo:wght@600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
:root{
  --moe-dark:#0c594e; --moe-green:#0f7a66; --moe-lite:#e8f4f1;
  --ink:#123b37; --line:#cfe1dd; --border:#e6efec; --bg:#fbfdfc;
  --good:#16a34a; --mid:#f59e0b; --bad:#ef4444;
  --strip:#f1fbf7;
  --base: clamp(14px, 1.3vw + 10px, 16px);

  /* درجات للهوية الخضراء (موحدة للأزرار السفلية) */
  --soft-green:#e9f7ee;
  --soft-green-b:#b9e4c8;
  --soft-green-t:#0f6a3b;
}
*{box-sizing:border-box}
html,body{margin:0;background:#fff;color:var(--ink);font-family:"Tajawal",system-ui;font-size:var(--base);min-height:100%}
#page{width:min(1200px,100vw);margin-inline:auto}
.wrap{padding:clamp(8px,2vw,16px)}
.hidden{display:none}

/* رأس */
.govern-head{display:flex;flex-direction:column;gap:4px;align-items:center;margin-top:6px}
.govern-head .hl{font-family:"Cairo";font-weight:700;color:#0a5b50;text-align:center;display:inline-flex;gap:6px;align-items:center}
.govern-head .hl.small{font-size:clamp(13px,1.1vw + 10px,16px)}
.govern-head .hl.big{font-size:clamp(14px,1.2vw + 10px,18px)}
.govern-head .editable{padding:2px 6px;border-radius:8px;background:var(--moe-lite);border:1px dashed transparent;cursor:text}
.govern-head .editable[contenteditable="true"]{border-color:#b6d8d1;background:#fffef5}
.inline-pen{border:1px solid var(--line);background:#fff;border-radius:8px;padding:4px 6px;cursor:pointer;display:inline-flex;align-items:center;gap:6px;color:#0b5e54}
.inline-pen svg{width:14px;height:14px}
h1{margin:10px 0 8px;color:#0f7a66;font-family:"Cairo","Tajawal";font-size:clamp(18px,1.6vw + 14px,26px);text-align:center}
.badge{display:inline-block;padding:4px 8px;border:1px solid var(--border);border-radius:10px;background:#eaf7f4;color:#0b6256;font-weight:700;font-size:12px}

/* صناديق */
.box{border:1px solid var(--border);border-radius:14px;background:var(--bg);margin-top:10px;overflow:hidden}
.box h3{margin:0;padding:10px 12px;border-bottom:1px solid var(--border);font-size:15px;color:#0c594e;display:flex;gap:10px;align-items:center}
.grid{display:grid;grid-template-columns:repeat(12,minmax(0,1fr));gap:8px}
.fld{height:38px;border:1px solid var(--line);border-radius:10px;padding:0 10px;background:#fff;font:inherit;text-align:center}
.col-3{grid-column:span 3/span 3}.col-12{grid-column:span 12/span 12}

/* أزرار عامة */
.btn-ic{display:inline-flex;gap:8px;align-items:center;padding:9px 12px;border-radius:12px;border:1px solid var(--line);background:#fff;color:#0b5e54;font-weight:800;cursor:pointer;font-size:clamp(12px,.6vw + 10px,14px);transition:transform .12s ease,text-shadow .12s ease}
.btn-ic:hover{transform:translateY(-1px)}
.btn-ic svg{width:18px;height:18px}
.btn-ic.tiny{padding:6px 8px}

/* توحيد لون وهوية الأزرار السفلية فقط */
.bottom-actions .btn-ic{
  background:var(--soft-green);
  border-color:var(--soft-green-b);
  color:var(--soft-green-t);
}

/* زيارات */
.visits{display:flex;gap:clamp(12px,2vw,24px);align-items:flex-start;justify-content:center;flex-wrap:wrap}
.visitCard{display:flex;flex-direction:column;align-items:center;gap:8px;position:relative}
.donut{width:clamp(84px, 10vw + 40px, 140px);height:auto;cursor:pointer}
.donut .ring{transform:rotate(-90deg);transform-origin:50% 50%}
.donut text{font-weight:800;fill:var(--moe-dark);font-size:14px}
.done-badge{position:absolute;top:-6px;right:-6px;background:#16a34a;color:#fff;border-radius:999px;padding:4px 6px;font-size:11px;display:none;box-shadow:0 2px 6px rgba(0,0,0,.15)}
.chip{background:#eaf7f4;border:1px dashed #cfe1dd;padding:4px 10px;border-radius:999px;font-size:clamp(11px,.6vw + 9px,12px);color:#0b6256;cursor:pointer}
.visitLabel{font-family:"Cairo";font-weight:700;color:#0f685a;font-size:clamp(13px,.8vw + 10px,16px)}

/* المؤشرات */
.hmeterTop{margin:8px auto 4px;text-align:center}
.tooltip{position:relative;display:inline-block;cursor:help;margin-bottom:6px;font-weight:700;color:#0b534a}
.tooltip .tiptext{visibility:hidden;width:290px;background:#0a5b50;color:#fff;text-align:center;border-radius:6px;padding:6px;position:absolute;z-index:2;bottom:125%;left:50%;transform:translateX(-50%);opacity:0;transition:opacity .3s}
.tooltip:hover .tiptext{visibility:visible;opacity:1}
.globalInline{margin-inline-start:8px;font-family:"Cairo";font-size:clamp(14px,1vw + 11px,18px);font-weight:800;transition:color .15s ease}
.globalInline.good{color:#0f6a3b}.globalInline.mid{color:#a8620a}.globalInline.bad{color:#b42318}
.visitPercents{display:flex;gap:8px;justify-content:center;align-items:center;flex-wrap:wrap;margin-bottom:4px}
.visitPercents .badge{background:#f0faf6}
.globalRow{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap}
.hbar{position:relative;width:min(700px,95vw);height:14px;border:1px solid var(--border);border-radius:999px;background:linear-gradient(90deg,#ef4444 0%,#f59e0b 50%,#16a34a 100%);margin:4px auto 6px}
.hthumb{position:absolute;top:50%;transform:translate(-50%,-50%);width:18px;height:18px;border-radius:50%;background:#fff;border:3px solid #0a5b50}
.hmeter{display:flex;flex-direction:column;gap:6px;align-items:center;margin:6px 0 8px}
.hbarSmall{position:relative;width:min(680px,95vw);height:12px;border:1px solid var(--border);border-radius:999px;background:linear-gradient(90deg,#ef4444 0%,#f59e0b 50%,#16a34a 100%)}
.hthumbSmall{position:absolute;top:50%;transform:translate(-50%,-50%);width:18px;height:18px;border-radius:50%;background:#fff;border:3px solid #0a5b50}
.hlbl{display:flex;gap:8px;align-items:center;color:#0a5b50;font-weight:800}

/* الجداول */
.table-responsive{width:100%;overflow:auto}
.tbl{width:100%;border-collapse:collapse;table-layout:auto}
.tbl th,.tbl td{border:1px solid var(--line);padding:6px 8px;background:#fff;vertical-align:middle;text-align:center}
.tbl thead th{background:var(--moe-dark)!important;color:#fff!important}
.tbl .w{width:clamp(280px,26vw,380px);text-align:center}
.tbl tbody td.seq{background:#f2fbf7;text-align:center;font-weight:700;color:#0c5e55}
.tbl tbody td.domain-cell{background:#f3faf8;text-align:center;vertical-align:middle;font-weight:800}
.group-colored td{background:var(--strip)!important}
.group-white   td{background:#fff!important}
.group-colored td.domain-cell{background:var(--strip)!important}
.group-white   td.domain-cell{background:#fff!important}

/* العنصر + التعريف */
.item-cell{display:flex;flex-direction:column;gap:3px;text-align:right}
.item-cell b{display:block}
.item-brief{display:block;margin-top:2px;padding-top:4px;border-top:1px dashed #dbe9e6;color:#2b5e57;opacity:.9;font-size:12px;line-height:1.55}

/* مستوى الأداء */
.level{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;align-items:stretch;width:100%}
.level button{--dot:#ddd;border:1px solid var(--line);background:#fff;border-radius:999px;cursor:pointer;font-weight:800;display:inline-flex;align-items:center;justify-content:center;gap:8px;transition:all .12s;width:100%;padding:10px 0}
.level button::before{content:"";width:10px;height:10px;border-radius:50%;background:var(--dot)}
.level button[data-v="1"]{--dot: var(--bad)}
.level button[data-v="2"]{--dot: var(--mid)}
.level button[data-v="3"]{--dot: var(--good)}
.level button.active{box-shadow:0 0 0 2px #cfe8df inset}
.level button.active[data-v="1"]{background:#ffe3e3;border-color:#f2bcbc;color:#b42318}
.level button.active[data-v="2"]{background:#fff1dc;border-color:#f2d3a2;color:#a8620a}
.level button.active[data-v="3"]{background:#e9f7ee;border-color:#b9e4c8;color:#0f6a3b}

/* الأدوات المساندة */
.bar-wrap{position:relative;margin:8px 12px 10px}
.gradbar{height:12px;border:1px solid var(--border);border-radius:999px;overflow:hidden;background:#eef3f2}
.bar-nums{position:absolute;inset:0;display:flex;justify-content:space-between;align-items:center;font-size:12px;font-weight:700;color:#0a5b50;padding:0 8px}
.pills{display:grid;grid-template-columns:repeat(3, minmax(84px,1fr));gap:8px;align-items:center}
.pill{display:inline-flex;align-items:center;justify-content:center;padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fff;cursor:pointer;font-weight:700;font-size:12px;width:100%}
.pill[data-v="2"].active{background:#e9f7ee;color:#0f6a3b;border-color:#b9e4c8}
.pill[data-v="1"].active{background:#fff1dc;color:#a8620a;border-color:#f2d3a2}
.pill[data-v="0"].active{background:#ffe3e3;color:#b42318;border-color:#f2bcbc}
/* وصف الأداة */
.tool-desc{display:block;opacity:.9;font-size:11px;line-height:1.6;margin-top:2px;text-wrap:balance;text-align:right}

/* التوصيات */
.rec-wrap{padding:10px}
.recTbl{width:100%;border-collapse:collapse}
.recTbl th,.recTbl td{border:1px solid var(--line);padding:8px;background:#fff;vertical-align:top;text-align:right}
.recTbl thead th{background:var(--moe-dark)!important;color:#fff!important}

/* شريط الأيقونات السفلي */
.bottom-actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center;padding:10px;border:1px solid var(--border);border-radius:14px;background:var(--bg);margin-top:12px}

/* تواقيع + دعم */
.signs{margin:10px 0}
.signs table{width:100%;border-collapse:collapse}
.signs th,.signs td{border:1px solid var(--line);padding:8px;background:#fff}
.sign-line{display:block;height:1px;border-bottom:1px dashed #9fb5b1;margin:8px 24px}
.support-title{font-weight:800;color:#0c594e;margin-bottom:4px}
.support-text{font-size:12.5px;line-height:1.7;color:#0b534a}
.support-badge{
  display:inline-flex;align-items:center;justify-content:center;gap:6px;
  padding:4px 8px;border:1px solid var(--soft-green-b);background:var(--soft-green);
  color:var(--soft-green-t);border-radius:999px;font-weight:800;font-size:11.5px;margin-bottom:6px
}
.support-badge svg{width:14px;height:14px}
.support-num{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:50%;background:#0f7a66;color:#fff;font-size:11px}

/* لوحة المعتمدين */
#approvedPanel{position:fixed;left:50%;transform:translateX(-50%);bottom:88px;min-width:min(520px,92vw);max-width:92vw;background:#fff;border:1px solid var(--border);border-radius:14px;box-shadow:0 12px 40px rgba(0,0,0,.15);padding:12px;display:none;z-index:1000}
#approvedPanel h4{margin:0 0 8px;color:#0c594e;font-family:"Cairo"}
#approvedList{display:flex;flex-wrap:wrap;gap:6px}
.name-chip{padding:6px 10px;border-radius:999px;border:1px dashed var(--line);background:#fafafa}

/* لوحة الأسماء (عدسة) */
#teachersPanel{position:fixed;inset:auto 0 0 0;margin:auto;max-width:min(780px,96vw);background:#fff;border:1px solid var(--border);border-radius:14px;box-shadow:0 16px 48px rgba(0,0,0,.2);display:none;z-index:1200}
.tp-head{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid var(--border)}
.tp-body{padding:10px;max-height:60vh;overflow:auto}
.tp-search{display:flex;gap:8px;align-items:center;margin-bottom:10px}
.tp-list{display:grid;grid-template-columns:repeat(2,minmax(160px,1fr));gap:8px}
.tp-item{padding:8px;border:1px solid var(--line);border-radius:12px;background:#fff;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.tp-item b{color:#0b5e54}
.tp-close{border:1px solid var(--line);background:#fff;border-radius:8px;padding:6px 10px;cursor:pointer}

/* شارة الطباعة */
.printMark{display:none;text-align:center;margin:6px 0 2px;color:#184b44;font-size:10px}

/* أزرار الصعود/النزول */
#toTop,#toBottom{
  position:fixed;bottom:20px;padding:12px;border:none;border-radius:50%;
  background:#0f7a66;color:#fff;font-size:18px;cursor:pointer;display:none;z-index:999;
  box-shadow:0 8px 20px rgba(0,0,0,.18);
  transition:transform .18s ease, box-shadow .18s ease, opacity .18s ease;
  opacity:.95
}
#toTop{left:20px}
#toBottom{right:20px}
#toTop:hover,#toBottom:hover{transform:translateY(-2px) scale(1.04); box-shadow:0 12px 28px rgba(0,0,0,.22)}

/* فوتر الحقوق */
.footer-rights{
  margin:8px 0 14px;
  text-align:center;
  font-size:11.5px;
  color:#0b534a;
}

/* إخفاء العناصر غير المرغوبة أثناء الحفظ/الطباعة عبر html2canvas */
body.snapshot .no-print{ display:none !important }

/* تجاوب */
@media (max-width:720px){ .grid{grid-template-columns:repeat(12,minmax(0,1fr));gap:6px} .tp-list{grid-template

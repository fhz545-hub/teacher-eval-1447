<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Ù…Ù‡Ù… Ù„Ù„Ø¬ÙˆØ§Ù„ -->
<title>Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<style>
:root{--moe:#0b7e88;--ink:#111;--sidebarW:350px;--b:#e6eeee}
*{box-sizing:border-box}
html,body{margin:0;background:#f6fafb;color:var(--ink);font:12.6px/1.8 Tajawal,system-ui;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}
p,li,span,strong,b{letter-spacing:0;word-spacing:.25px}

/* Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¹Ø§Ù… */
.app{display:grid;grid-template-columns:var(--sidebarW) 1fr;min-height:100vh}
@media (max-width:1024px){
  .app{grid-template-columns:1fr}
}

/* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª */
.sidebar{position:sticky;top:0;height:100vh;background:#fff;border-inline-end:1px solid #e8f2f2;box-shadow:0 0 24px rgba(0,0,0,.04);display:flex;flex-direction:column;z-index:5}
@media (max-width:1024px){
  .sidebar{position:relative;height:auto;top:auto;border-inline-end:0;border-bottom:1px solid #e8f2f2}
}
.sb-head{padding:12px;border-bottom:1px solid #eef4f4;font-weight:900;color:#064b50}
.sb-body{padding:10px;overflow:auto;max-height:calc(100vh - 120px)}
@media (max-width:1024px){.sb-body{max-height:none}}
.f{display:flex;flex-direction:column;gap:4px;margin-bottom:8px}
.f label{font-weight:800;color:#03636a;font-size:11.6px}
.sel,.inp,.btn{height:34px;border:1px solid #dbe9e9;border-radius:10px;background:#fff;padding:6px 9px;font-weight:800}
.sel{appearance:none;background-image:linear-gradient(45deg,transparent 50%,#89a 0),linear-gradient(135deg,#89a 50%,transparent 0);background-position:calc(100% - 18px) 50%,calc(100% - 12px) 50%;background-size:6px 6px,6px 6px;background-repeat:no-repeat;cursor:pointer}
.row{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
.chips{display:flex;gap:6px;flex-wrap:wrap}
.chip{border:1px solid #dbe9e9;border-radius:12px;background:#f2fafb;color:#0b5e63;font-weight:900;padding:6px 10px;cursor:pointer}
.chip.active{background:var(--moe);color:#fff;border-color:transparent}
.btn{cursor:pointer}.btn.ghost{background:#eef7f7}.btn.primary{background:var(--moe);color:#fff;border-color:transparent}.btn.wh{background:#25D366;color:#fff;border-color:#1aae53}
.sb-actions{margin-top:8px;display:flex;flex-direction:column;gap:8px}
.rights{font-size:10px;color:#7a8790;text-align:center;padding:8px 10px;border-top:1px dashed #eef4f4;margin-top:auto}
.disabled{opacity:.45;pointer-events:none;filter:grayscale(1)}

/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
.content{padding:16px}
.sheet-wrap{display:flex;justify-content:center;overflow:auto}
.sheet{width:100%;max-width:210mm;min-height:297mm;background:#fff;border:1px solid var(--b);border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.04)}
.pad{padding:8mm 10mm 9mm}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
.hdr{position:relative;margin:0 0 5mm}
.hdr img{width:100%;display:block;border-radius:12px;image-rendering:auto}
.meta-stack{position:absolute;inset-inline-end:12px;top:12px;display:flex;flex-direction:column;gap:6px;min-width:130px;transform:translateX(4px)}
.meta-stack .rowB{background:transparent;border:0;border-radius:10px;padding:6px 10px;font-weight:900;text-align:center}

/* Ø¹Ù†ÙˆØ§Ù† Ù…Ø±ÙƒØ²ÙŠ */
.title-center{text-align:center;margin:5mm 0 3mm}
.title-center .t{font-weight:900;font-size:22px;color:#064b50}

/* Ø¬Ø¯ÙˆÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… */
.tbl{width:100%;border-collapse:collapse;table-layout:fixed}
.tbl th{background:#0b5e63;color:#fff;border:1px solid #244a4a;padding:6px 7px;font-weight:900}
.tbl td{border:1px solid #3f5b57;padding:5px 7px;height:10mm;text-align:center}
.tbl .name{width:38%}.tbl .spec{width:14%}.tbl .level{width:16%}.tbl .job{width:16%}.tbl .work{width:16%}

/* Ø´Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ */
.badges-under{margin:6px auto 0;display:flex;gap:10px;justify-content:flex-start;align-items:center;width:100%}
.badge{display:inline-flex;align-items:center;gap:8px;border:1px solid #0b7e88;border-radius:10px;padding:2px 10px;background:#fff;font-weight:900}
.badge .tag{background:var(--moe);color:#fff;border-radius:8px;padding:2px 8px}

/* Ø£Ù‚Ø³Ø§Ù… */
.sec{margin-top:6mm}
.sec h3{margin:0 0 6px;color:#0b5e63;font-size:14px}
.rule-row{display:flex;align-items:center;gap:6px;margin-top:3px}
.rule-row .label{font-weight:900;white-space:nowrap}
.dotfield{display:inline-block;min-width:25mm;border-bottom:1px dotted #2f4f4c;text-align:center;padding:0 2mm}
.timebox{display:inline-block;min-width:26mm;text-align:center;padding:.4mm 2.5mm;background:#fff;color:#111;font-weight:900;border-radius:6px;border:1px solid #000;font-family:ui-monospace,Consolas,monospace;font-size:12px;cursor:text}
.timebox.empty{color:#777;border-color:#bbb}
.checks{margin:5px 0 6px}
.checkline{display:flex;align-items:flex-start;gap:6px;margin:5px 0}
.checkline input{margin-top:3px;transform:scale(1.05)}
.checkline .text{flex:1}
.calc{font-weight:900;color:#0b5e63}

/* Ø®Ø·ÙˆØ· Ø§Ù„ÙƒØªØ§Ø¨Ø© */
.lines{min-height:26mm;border:1px dashed #2f4f4c;border-radius:10px;padding:8px 10px;background:#fafefe}
.lines div{height:9mm;border-bottom:1px dotted #2f4f4c}
.lines div:last-child{border-bottom:0}
.lines.dotted{border-color:#cfd8d8}
.lines.dotted div{border-bottom:1px dotted #c7cfd0}

/* Ø¹Ø¨Ø§Ø±Ø© â€œØªØ­ÙØ¸ â€¦â€ */
.footer-note{margin-top:10mm}
.footer-note span{display:inline-block;margin-inline-end:auto;color:#333;font-size:10.5px;font-weight:800}

/* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
#statsDlg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.35);z-index:50;align-items:center;justify-content:center;padding:12px}
.stats-card{background:#fff;border-radius:16px;max-width:1100px;width:96%;max-height:90vh;overflow:auto;border:1px solid var(--b)}
.stats-card .h{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid #eef4f4}
.stats-hdr{position:relative;margin:8px 8px 10px}
.stats-hdr img{width:100%;display:block;border-radius:12px}
.stats-meta{position:absolute;inset-inline-end:12px;top:12px;display:flex;flex-direction:column;gap:6px;min-width:130px}
.stats-meta .rowB{background:transparent;border:0;border-radius:10px;padding:6px 10px;font-weight:900;text-align:center}
.tbl2{width:100%;border-collapse:collapse}
.tbl2 th{background:#0b5e63;color:#fff;border:1px solid #2b4949;padding:6px 8px;position:sticky;top:0}
.tbl2 td{border:1px solid #2b4949;padding:6px 8px}
.tbl2 .no-print{ /* Ù†Ø®ÙÙŠÙ‡Ø§ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙÙ‚Ø· Ø¹Ø¨Ø± @media print */ }

/* Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© */
#clockDlg{display:none;position:fixed;inset:0;z-index:60;background:rgba(0,0,0,.35);align-items:center;justify-content:center;padding:16px}
.clock-card{background:#fff;border:1px solid var(--b);border-radius:16px;max-width:360px;width:96%}
.clock-card .h{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid #eef4f4}
.clock-card .b{padding:12px}
.clock-row{display:flex;gap:8px;align-items:center;justify-content:space-between}
.clock-row .col{flex:1}
.clock-row input[type=range]{width:100%}
.clock-big{font:900 26px/1 Tajawal,system-ui;text-align:center;color:#064b50;margin:8px 0}
.clock-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
.clock-actions .btn{height:auto;padding:7px 10px}

/* Ø·Ø¨Ø§Ø¹Ø© Ù‚ÙˆÙŠØ© ÙˆÙˆØ§Ø¶Ø­Ø© */
*{-webkit-print-color-adjust:exact; print-color-adjust:exact}
@media print{
  @page{size:A4;margin:10mm}
  body{background:#fff}

  /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
  body[data-print="stats"] .app{display:none !important}

  /* Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙ‚Ø· Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
  body[data-print="stats"] #statsDlg[aria-hidden="false"]{
    display:block !important; position:static !important; inset:auto !important;
    background:#fff !important; padding:0 !important;
  }
  body[data-print="stats"] #statsDlg .stats-card{
    border:0 !important;border-radius:0 !important;width:210mm !important;max-width:none !important;
    min-height:auto !important;max-height:none !important;overflow:visible !important;box-shadow:none !important;margin:0 auto !important;
    page-break-inside:avoid;
  }

  /* Ù†ÙØ¸Ù‡Ø± Ø§Ù„Ù‡ÙŠØ¯Ø± ÙÙŠ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø·Ø¨ÙˆØ¹Ù‹Ø§ ÙƒØ§Ù…Ù„Ø§Ù‹ */
  body[data-print="stats"] #statsDlg .stats-hdr{display:block !important;margin:0 0 6mm !important}
  body[data-print="stats"] #statsDlg .stats-hdr img{width:100% !important;height:auto !important;border-radius:8px !important}
  body[data-print="stats"] #statsDlg .stats-meta .rowB{background:transparent !important;border:0 !important}

  /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
  body[data-print="stats"] #statsDlg .h,
  body[data-print="stats"] #statsDlg .stats-actions{display:none !important}

  /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: Ø¹Ù†ÙˆØ§Ù† Ù…ØªÙƒØ±Ø± Ù„ÙƒÙ„ ØµÙØ­Ø© ÙˆØ¥Ø®ÙØ§Ø¡ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø­Ø°Ù */
  body[data-print="stats"] #tblStats thead{display:table-header-group}
  body[data-print="stats"] #tblStats tfoot{display:table-footer-group}
  body[data-print="stats"] #tblStats th,
  body[data-print="stats"] #tblStats td{border-color:#000 !important}
  body[data-print="stats"] #tblStats th{background:#0b5e63 !important;color:#fff !important}
  body[data-print="stats"] #tblStats tr{page-break-inside:avoid}
  body[data-print="stats"] #tblStats th:last-child,
  body[data-print="stats"] #tblStats td:last-child,
  body[data-print="stats"] #tblStats .no-print{display:none !important}

  /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙØ­Ø© Ø®Ø§Ø±Ø¬ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙŠØ·Ø¨Ø¹ Ø·Ø¨ÙŠØ¹ÙŠÙ‹Ø§ */
  body:not([data-print="stats"]) .sidebar,
  body:not([data-print="stats"]) .rights,
  body:not([data-print="stats"]) #clockDlg{display:none !important}
  body:not([data-print="stats"]) .content{padding:0}
  body:not([data-print="stats"]) .sheet{width:210mm;min-height:auto;border:0;box-shadow:none;page-break-inside:avoid}
  body:not([data-print="stats"]) .pad{padding:7mm 9mm 8mm}
  body:not([data-print="stats"]) .hdr{margin:0 0 4mm}
  body:not([data-print="stats"]) .hdr img{max-height:40mm;object-fit:cover;border-radius:8px}
  body:not([data-print="stats"]) .title-center{margin:4mm 0 2mm}
  body:not([data-print="stats"]) .tbl th{background:#0b5e63 !important;color:#fff !important;border-color:#000 !important}
  body:not([data-print="stats"]) .tbl td{border-color:#000 !important}
  body:not([data-print="stats"]) .timebox{border-color:#000 !important;color:#000 !important}
  body:not([data-print="stats"]) .lines{border-color:#000 !important}
  body:not([data-print="stats"]) .lines div{border-color:#000 !important}
  body:not([data-print="stats"]) .dotfield{border-bottom:1px dotted #000 !important}

  /* Ø¶ØºØ· Ø®Ø§Øµ Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡/Ø§Ù„Ù…Ø³Ø§Ø¡Ù„Ø© */
  #alertPack, #absencePack{line-height:1.45 !important}
  #alertPack p, #absencePack p{margin:2mm 0 1.5mm !important}
  #alertPack .sec, #absencePack .sec{margin-top:4mm !important}
  #alertPack .checkline, #absencePack .checkline{margin:3mm 0 !important;gap:4px !important}
  #alertPack .lines div, #absencePack .lines div{height:6mm !important}
  #alertPack .lines, #absencePack .lines{padding:6px 8px !important}
}
</style>
</head>
<body>
<div class="app">

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª -->
  <aside class="sidebar" id="sidebar">
    <div class="sb-head">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</div>
    <div class="sb-body">
      <div class="f">
        <label>Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</label>
        <div class="chips" id="kindChips">
          <button class="chip active" data-k="late">ØªØ£Ø®Ø±</button>
          <button class="chip" data-k="absent">Ø¹Ø¯Ù… ØªÙˆØ§Ø¬Ø¯</button>
          <button class="chip" data-k="early">Ø§Ù†ØµØ±Ø§Ù</button>
          <button class="chip" data-k="gaib">Ù…Ø³Ø§Ø¡Ù„Ø© ØºÙŠØ§Ø¨</button>
          <button class="chip" data-k="note">Ù„ÙØª Ù†Ø¸Ø±</button>
        </div>
      </div>

      <div class="f">
        <label>Ø§Ù„Ù…Ø¹Ù„Ù‘Ù…</label>
        <select id="selTeacher" class="sel"></select>
      </div>

      <div class="f">
        <label>ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¯ÙˆØ§Ù…</label>
        <div class="chips" id="seasonChips">
          <button class="chip active" data-season="winter">Ø§Ù„Ø´ØªÙˆÙŠ (07:00â€“14:00)</button>
          <button class="chip" data-season="summer">Ø§Ù„ØµÙŠÙÙŠ (06:45â€“13:45)</button>
        </div>
      </div>

      <!-- Ø£Ø³Ø¨Ø§Ø¨ Ù„ÙØª Ø§Ù„Ù†Ø¸Ø± -->
      <div class="f">
        <label>Ø³Ø¨Ø¨ Ù„ÙØª Ø§Ù„Ù†Ø¸Ø±</label>
        <select id="noteReason" class="sel">
          <option value="">â€” Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¨Ø¨ â€”</option>
          <option>Ø¹Ø¯Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ø¥Ø´Ø±Ø§Ù Ø§Ù„ØµØ¨Ø§Ø­ÙŠ ÙˆÙÙ‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯.</option>
          <option>Ø§Ù„ØªÙ‚ØµÙŠØ± ÙÙŠ Ù…Ù†Ø§ÙˆØ¨Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù… Ù…Ù…Ø§ Ø£Ø«Ù‘Ø± Ø¹Ù„Ù‰ Ø§Ù†Ø¶Ø¨Ø§Ø· Ø®Ø±ÙˆØ¬ Ø§Ù„Ø·Ù„Ø§Ø¨.</option>
          <option>Ù‚ØµÙˆØ± ÙÙŠ Ø§Ù„Ø­Ø¶ÙˆØ± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø´Ø±Ø§Ù ÙˆÙ‚Øª Ø§Ù„ÙØ³Ø­Ø© Ù…Ù…Ø§ Ø£Ø¯Ù‰ Ø¥Ù„Ù‰ Ø¶Ø¹Ù Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</option>
          <option>Ø¹Ø¯Ù… Ø§Ù„Ø¥Ø´Ø±Ø§Ù Ø¹Ù„Ù‰ ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…ØµÙ„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ.</option>
          <option>Ø¹Ø¯Ù… Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙÙŠ Ù…Ù†ØµØ© Ù…Ø¯Ø±Ø³ØªÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª.</option>
          <option>Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø­ØµØ© Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¦Ù‡Ø§ Ø¯ÙˆÙ† Ù…Ø¨Ø±Ø± Ù†Ø¸Ø§Ù…ÙŠ.</option>
          <option>Ø§Ù„ØªØ£Ø®Ø± Ø¹Ù† Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø­ØµØ© ÙˆÙÙ‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ.</option>
          <option>Ø¹Ø¯Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù„Ø·Ø§Ø¨ÙˆØ± Ø§Ù„ØµØ¨Ø§Ø­ÙŠ Ø¯ÙˆÙ† Ø¹Ø°Ø±.</option>
          <option>Ø§Ù„ØªØºÙŠØ¨ Ø¹Ù† Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø±Ø³Ù…ÙŠ Ø¯ÙˆÙ† Ø¹Ø°Ø±.</option>
          <option>Ø¹Ø¯Ù… Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ù…Ø³Ø§Ø¡Ù„Ø© Ø¥Ø¯Ø§Ø±ÙŠØ© ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø¯.</option>
          <option>Ø±ÙØ¶ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø£Ùˆ Ø§Ù„Ù…Ø­Ø§Ø¶Ø± Ø§Ù„Ø±Ø³Ù…ÙŠØ©.</option>
          <option>Ø±ÙØ¶ ØªÙ†ÙÙŠØ° ØªÙˆØ¬ÙŠÙ‡ Ø¥Ø¯Ø§Ø±ÙŠ Ø£Ùˆ ØªØ±Ø¨ÙˆÙŠ Ø¯ÙˆÙ† Ù…Ø¨Ø±Ø±.</option>
          <option>Ø¹Ø¯Ù… Ø±ÙØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØºÙŠØ§Ø¨ ÙÙŠ (ÙØ§Ø±Ø³) Ø¨Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯.</option>
          <option>Ø¹Ø¯Ù… Ø¯Ø®ÙˆÙ„ Ø­ØµØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙƒÙ„Ù‘ÙÙ Ø¨Ù‡Ø§.</option>
          <option>Ø¹Ø¯Ù… Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø­ØµØ© Ø§Ù„Ø±Ø³Ù…ÙŠØ© ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ø¯ÙˆÙ† Ø§Ø³ØªØ¦Ø°Ø§Ù† .</option>
          <option>Ø§Ù„ØªÙ‚ØµÙŠØ± ÙÙŠ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙÙŠ (Ù†ÙˆØ±) Ø¶Ù…Ù† Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯.</option>
        </select>
      </div>

      <!-- Ø§Ù„Ù…ÙˆØ­Ù‘Ø¯: Ø§Ù„Ø¹Ø°Ø±/Ø§Ù„Ù‚Ø¨ÙˆÙ„/ÙØ§Ø±Ø³ -->
      <div class="f">
        <label>Ø§Ù„Ø¹Ø°Ø±/Ø§Ù„Ù‚Ø¨ÙˆÙ„/ÙØ§Ø±Ø³</label>
        <button id="btnUnified" class="btn ghost" style="width:100%;display:flex;justify-content:space-between;align-items:center">
          <span id="unifiedText">Ø¨Ø¯ÙˆÙ† Ø¹Ø°Ø±</span><span>â–¾</span>
        </button>
        <div id="unifiedPanel" style="display:none;border:1px solid #dbe9e9;border-radius:10px;padding:8px;margin-top:6px">
          <div class="f" style="margin:0">
            <label>Ø§Ù„Ø¹Ø°Ø±</label>
            <div class="chips" id="excuseGroup">
              <button class="chip" data-exc="with">Ø¨Ø¹Ø°Ø±</button>
              <button class="chip active" data-exc="without">Ø¨Ø¯ÙˆÙ† Ø¹Ø°Ø±</button>
            </div>
          </div>
          <div class="f" style="margin:6px 0 0">
            <label>Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¹Ø°Ø±</label>
            <div class="chips" id="acceptGroup">
              <button class="chip" data-acc="accepted">Ù…Ù‚Ø¨ÙˆÙ„</button>
              <button class="chip active" data-acc="rejected">ØºÙŠØ± Ù…Ù‚Ø¨ÙˆÙ„</button>
            </div>
          </div>
          <div class="f" style="margin:6px 0 0">
            <label>ÙØ§Ø±Ø³ â€” ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù…Ø³Ø§Ø¡Ù„Ø© Ø§Ù„ØºÙŠØ§Ø¨</label>
            <div class="chips" id="frGroup">
              <button class="chip" data-fr="raised">Ù…Ø±ÙÙˆØ¹</button>
              <button class="chip active" data-fr="not">Ù„Ù… ÙŠÙØ±ÙØ¹</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Ø§Ù„ØªØ§Ø±ÙŠØ® -->
      <div class="f">
        <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
        <div class="row"><button id="btnCalToggle" class="btn" style="flex:1">ğŸ—“ï¸ Ù‡Ø¬Ø±ÙŠ</button></div>
        <div id="pickHijri" class="row" style="margin-top:6px">
          <select id="hY" class="sel" style="width:33%"></select>
          <select id="hM" class="sel" style="width:33%"></select>
          <select id="hD" class="sel" style="width:34%"></select>
        </div>
        <div id="pickGreg" class="row" style="display:none;margin-top:6px">
          <input id="gY" class="inp" type="number" min="1900" max="2100" placeholder="YYYY" style="width:40%">
          <input id="gM" class="inp" type="number" min="1" max="12" placeholder="MM" style="width:30%">
          <input id="gD" class="inp" type="number" min="1" max="31" placeholder="DD" style="width:30%">
        </div>
      </div>

      <div class="sb-actions">
        <button id="btnStats" class="btn ghost">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ğŸ“Š</button>
        <button id="btnWA" class="btn wh">ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button id="btnPrintSave" class="btn primary">Ø·Ø¨Ø§Ø¹Ø© / Ø­ÙØ¸</button>
      </div>
    </div>
    <div class="rights">Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„ÙŠØ¹Ù‚ÙˆØ¨ÙŠ â€” ØªØ·ÙˆÙŠØ±: ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ (Ù„Ø§ ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©)</div>
  </aside>

  <!-- ØµÙØ­Ø© A4 -->
  <main class="content">
    <div class="sheet-wrap">
      <div class="sheet" id="sheet" aria-label="ØµÙØ­Ø© A4">
        <div class="pad">

          <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
          <div class="hdr">
            <img id="hdrImg" src="hhh.png" alt="Ù‡ÙŠØ¯Ø±" crossorigin="anonymous">
            <div class="meta-stack">
              <div class="rowB" id="metaDay">â€”</div>
              <div class="rowB" id="metaHijri">â€”</div>
              <div class="rowB">Ø§Ù„Ø±Ù‚Ù…: <span id="metaNo">01</span></div>
            </div>
          </div>

          <div class="title-center"><div class="t" id="mainTitle">ØªÙ†Ø¨ÙŠÙ‡</div></div>

          <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… -->
          <table class="tbl">
            <thead><tr>
              <th class="name">Ø§Ù„Ø§Ø³Ù…</th><th class="spec">Ø§Ù„ØªØ®ØµØµ</th><th class="level">Ø§Ù„Ù…Ø±ØªØ¨Ø©</th>
              <th class="job">Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙØ©</th><th class="work">Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ</th>
            </tr></thead>
            <tbody><tr>
              <td id="t_name">â€”</td><td id="t_spec">â€”</td><td id="t_level">â€”</td><td id="t_job">â€”</td><td id="t_work">â€”</td>
            </tr></tbody>
          </table>

          <!-- Ø´Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ -->
          <div class="badges-under">
            <div class="badge"><span class="tag">Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ</span><span id="t_civil">â€”</span></div>
          </div>

          <!-- (1) Ø®Ø·Ø§Ø¨ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
          <div id="alertPack" class="sec">
            <h3>( 1 ) Ø®Ø·Ø§Ø¨ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ â€” <span id="kindTitle">ØªØ£Ø®Ø±</span></h3>
            <div class="rule-row"><span class="label">Ø§Ù„Ù…ÙƒØ±Ù… Ø§Ù„Ù…Ø¹Ù„Ù… :</span>
              <strong id="teacherNameInline" style="min-width:38mm;text-align:center;border-bottom:1px dotted #2Ù4f4c;display:inline-block;padding:0 2mm">â€”</strong>
              <span>ÙˆÙÙ‚Ù‡ Ø§Ù„Ù„Ù‡</span></div>
            <p><strong>Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ØŒ ÙˆØ¨Ø¹Ø¯ ØŒØŒØŒ</strong></p>
            <p>Ø¥Ù†Ù‡ ÙÙŠ ÙŠÙˆÙ… <span class="dotfield"><span id="dynDay">â€”</span></span>
              Ø§Ù„Ù…ÙˆØ§ÙÙ‚ <span class="dotfield"><span id="dynHijri">â€”</span></span> :</p>

            <div class="checks">
              <label id="lineLate" class="checkline">
                <input type="checkbox" checked>
                <span class="text">
                  ØªØ£Ø®Ø±ÙƒÙ… Ù…Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„ØŒ ÙˆØ­Ø¶ÙˆØ±ÙƒÙ… Ø§Ù„Ø³Ø§Ø¹Ø© ( <span id="tLateIn" class="timebox empty" contenteditable="true" data-mask>--:--</span> ).
                  <span class="calc">â€” Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ£Ø®Ø±: <span id="lateTotal">0 Ø¯Ù‚ÙŠÙ‚Ø©</span> (<span id="lateHH">00:00</span> Ø³)</span>
                </span>
              </label>

              <label id="lineAbs" class="checkline" style="display:none">
                <input type="checkbox" checked>
                <span class="text">
                  Ø¹Ø¯Ù… ØªÙˆØ§Ø¬Ø¯ÙƒÙ… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ø³Ø§Ø¹Ø© : ( <span id="tAbsFrom" class="timebox empty" contenteditable="true" data-mask>--:--</span> )
                  Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø§Ø¹Ø© : ( <span id="tAbsTo" class="timebox empty" contenteditable="true" data-mask>--:--</span> ).
                  <span class="calc">â€” Ù…Ø¯Ø© Ø¹Ø¯Ù… Ø§Ù„ØªÙˆØ§Ø¬Ø¯: <span id="absTotal">0 Ø¯Ù‚ÙŠÙ‚Ø©</span> (<span id="absHH">00:00</span> Ø³)</span>
                </span>
              </label>

              <label id="lineEarly" class="checkline" style="display:none">
                <input type="checkbox" checked>
                <span class="text">
                  Ø§Ù†ØµØ±Ø§ÙÙƒÙ… Ù…Ø¨ÙƒØ±Ù‹Ø§ Ù‚Ø¨Ù„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ø³Ø§Ø¹Ø© : ( <span id="tEarlyFrom" class="timebox empty" contenteditable="true" data-mask>--:--</span> ).
                  <span class="calc">â€” Ù…Ø¯Ø© Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…Ø¨ÙƒØ±: <span id="earlyTotal">0 Ø¯Ù‚ÙŠÙ‚Ø©</span> (<span id="earlyHH">00:00</span> Ø³)</span>
                </span>
              </label>
            </div>

            <p>Ø¹Ù„ÙŠÙ‡ Ù†Ø£Ù…Ù„ ØªÙˆØ¶ÙŠØ­ Ø£Ø³Ø¨Ø§Ø¨ Ø°Ù„Ùƒ Ù…Ø¹ Ø¥Ø±ÙØ§Ù‚ Ù…Ø§ ÙŠØ¤ÙŠØ¯ Ø¹Ø°Ø±ÙƒÙ… â€¦ ÙˆÙ„ÙƒÙ… ØªØ­ÙŠØ§ØªÙ†Ø§.</p>
            <p style="margin-top:6px"><strong>Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø© :</strong> <span>ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</span>
              &nbsp;&nbsp; <strong>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ :</strong> <span class="dotfield" style="min-width:26mm"></span>
              &nbsp;&nbsp; <strong>Ø§Ù„ØªØ§Ø±ÙŠØ® :</strong> <span class="dotfield" style="min-width:20mm"></span></p>
          </div>

          <!-- (2) Ø¥ÙØ§Ø¯Ø© Ø§Ù„Ù…Ø¹Ù„Ù… â€” Ø³Ø·Ø±Ø§Ù† ÙÙ‚Ø· -->
          <div id="affidavitPack" class="sec">
            <h3>( 2 ) Ø¥ÙØ§Ø¯Ø© Ø§Ù„Ù…Ø¹Ù„Ù…</h3>
            <p>Ø£ÙÙÙŠØ¯ÙƒÙ… Ø¨Ø£Ù† Ø³Ø¨Ø¨ <span id="affKind">Ø§Ù„ØªØ£Ø®Ø±</span> Ø§Ù„Ù…ÙˆØ¶Ù‘Ø­ Ø£Ø¹Ù„Ø§Ù‡ Ù‡Ùˆ:</p>
            <div class="lines"><div></div><div></div></div>
            <p style="margin-top:6px">
              <strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù… :</strong> <span id="affTeacher">â€”</span>
              &nbsp;&nbsp; <strong>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ :</strong> ____________________
              &nbsp;&nbsp; <strong>Ø§Ù„ØªØ§Ø±ÙŠØ® :</strong> ______ / ______ / ______
            </p>
          </div>

          <!-- (3) Ø±Ø£ÙŠ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø© -->
          <div id="principalPack" class="sec">
            <h3>( 3 ) Ø±Ø£ÙŠ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</h3>
            <label class="checkline"><input type="checkbox"> ØªÙ…Ù‘ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…ÙˆØ¸Ù Ø´ÙÙ‡ÙŠÙ‹Ø§ Ø¨Ø§Ù„Ø£Ø®Ø° Ø¨Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·.</label>
            <label class="checkline"><input type="checkbox"> ÙŠÙÙƒØªÙÙ‰ Ø¨Ù‡Ø°Ø§ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø¹ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø®Ù„Ø§Ù„ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.</label>
            <label class="checkline"><input type="checkbox"> ÙŠÙØ±ÙØ¹ Ù„Ø¬Ù‡Ø© Ø§Ù„Ø§Ø®ØªØµØ§Øµ Ø¹Ù†Ø¯ ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©.</label>
            <p style="margin-top:6px">
              <strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± :</strong> <span>ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</span>
              &nbsp;&nbsp; <strong>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ :</strong> ____________________
              &nbsp;&nbsp; <strong>Ø§Ù„ØªØ§Ø±ÙŠØ® :</strong> ______ / ______ / ______
            </p>
          </div>

          <!-- Ù…Ø³Ø§Ø¡Ù„Ø© Ø§Ù„ØºÙŠØ§Ø¨ -->
          <div id="absencePack" class="sec" style="display:none">
            <p>Ø¥Ù†Ù‡ ÙÙŠ ÙŠÙˆÙ… <strong><span id="absDayP">â€”</span></strong>
              Ø§Ù„Ù…ÙˆØ§ÙÙ‚ <strong><span id="absDateYMD">â€”</span></strong> ØªØºÙŠØ¨Øª Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„.</p>
            <h3>( 1 ) Ø·Ù„Ø¨ Ø§Ù„Ø¥ÙØ§Ø¯Ø©</h3>
            <p><strong>Ø§Ù„Ù…ÙƒØ±Ù… /</strong> <span id="abs-name-top">â€”</span> <span>ÙˆÙÙ‚Ù‡ Ø§Ù„Ù„Ù‡</span></p>
            <p><strong>Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ØŒ ÙˆØ¨Ø¹Ø¯ ØŒØŒØŒ</strong></p>
            <p>Ù…Ù† Ø®Ù„Ø§Ù„ Ù…ØªØ§Ø¨Ø¹Ø© Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙˆØ§Ù… ØªØ¨ÙŠÙ† ØºÙŠØ§Ø¨ÙƒÙ… Ø®Ù„Ø§Ù„ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…ÙˆØ¶Ø­Ø© Ø¨Ø¹Ø§Ù„ÙŠØ©ØŒ Ø¢Ù…Ù„ Ø§Ù„Ø¥ÙØ§Ø¯Ø© Ø¹Ù† Ø³Ø¨Ø¨ Ø°Ù„Ùƒ
              ÙˆØªÙ‚Ø¯ÙŠÙ… Ù…Ø§ ÙŠØ¤ÙŠØ¯ Ø¹Ø°Ø±ÙƒÙ… Ø®Ù„Ø§Ù„ Ø£Ø³Ø¨ÙˆØ¹ Ù…Ù† ØªØ§Ø±ÙŠØ®Ù‡Ø› Ø¹Ù„Ù…Ø§Ù‹ Ø¨Ø£Ù†Ù‡ ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø³ÙŠØªÙ… Ø§ØªØ®Ø§Ø° Ø§Ù„Ù„Ø§Ø²Ù… Ø­Ø³Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª.</p>
            <p><strong>Ø§Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± :</strong> <span>ÙÙ‡Ø¯ Ø¨Ù† Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</span>
               &nbsp;&nbsp; <strong>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ :</strong> ________ &nbsp;&nbsp; <strong>Ø§Ù„ØªØ§Ø±ÙŠØ® :</strong> ______ / ______ / ______</p>

            <h3>( 2 ) Ø§Ù„Ø¥ÙØ§Ø¯Ø© â€” Ø³Ø·Ø±Ø§Ù† ÙÙ‚Ø·</h3>
            <p><strong>Ø§Ù„Ù…ÙƒØ±Ù… / Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</strong> ÙˆÙÙ‚Ù‡ Ø§Ù„Ù„Ù‡</p>
            <p><strong>Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ØŒ ÙˆØ¨Ø¹Ø¯ ØŒØŒØŒ</strong></p>
            <p>Ø£ÙÙŠØ¯ÙƒÙ… Ø£Ù† ØºÙŠØ§Ø¨ÙŠ ÙƒØ§Ù† Ù„Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ØªØ§Ù„ÙŠØ©:</p>
            <div class="lines dotted"><div></div><div></div></div>
            <p>ÙˆØ³Ø£Ù‚ÙˆÙ… Ø¨ØªÙ‚Ø¯ÙŠÙ… Ù…Ø§ ÙŠØ«Ø¨Øª Ø°Ù„Ùƒ Ø®Ù„Ø§Ù„ Ø£Ø³Ø¨ÙˆØ¹ Ù…Ù† ØªØ§Ø±ÙŠØ®Ù‡.</p>
            <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù… :</strong> <span id="abs-teacher-name">â€”</span> &nbsp;&nbsp; <strong>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ :</strong> ________ &nbsp;&nbsp; <strong>Ø§Ù„ØªØ§Ø±ÙŠØ® :</strong> ______ / ______ / ______</p>

            <h3>( 3 ) Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</h3>
            <label><input type="checkbox"> ØªÙØ­ØªØ³Ø¨ Ù„Ù‡ Ø¥Ø¬Ø§Ø²Ø© Ù…Ø±Ø¶ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ø¸Ø§Ù…ÙŠØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±.</label><br>
            <label><input type="checkbox"> ÙŠÙØ­ØªØ³Ø¨ ØºÙŠØ§Ø¨Ù‡ Ù…Ù† Ø±ØµÙŠØ¯Ù‡ Ù„Ù„Ø¥Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ø¥Ø¶Ø·Ø±Ø§Ø±ÙŠØ© Ù„Ù‚Ø¨ÙˆÙ„ Ø¹Ø°Ø±Ù‡ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±ØµÙŠØ¯Ù‡ ÙŠØ³Ù…Ø­ ÙˆÙ„Ø§ ÙŠÙØ­Ø³Ù… Ø¹Ù„ÙŠÙ‡.</label><br>
            <label><input type="checkbox"> ÙŠØ¹ØªÙ…Ø¯ Ø§Ù„Ø­Ø³Ù… Ù„Ø¹Ø¯Ù… Ù‚Ø¨ÙˆÙ„ Ø¹Ø°Ø±Ù‡.</label>

            <!-- ( 4 ) ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ± â€” ØªØ³Ø­Ø¨ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Ù‹ -->
            <div class="sec" id="principalSignPack" style="margin-top:6mm">
              <h3>( 4 ) ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ±</h3>
              <p>
                <strong>Ø§Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± :</strong> <span id="principalNameAbs">â€”</span>
                &nbsp;&nbsp; <strong>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ :</strong> <span id="principalSignAbs">____________________</span>
                &nbsp;&nbsp; <strong>Ø§Ù„ØªØ§Ø±ÙŠØ® :</strong> <span id="principalDateAbs">â€”</span>
              </p>
            </div>
          </div>

          <!-- Ù„ÙØª Ù†Ø¸Ø± -->
          <div id="notePack" class="sec" style="display:none">
            <h3>Ù†Ù…ÙˆØ°Ø¬ Ù„ÙØª Ù†Ø¸Ø±</h3>
            <p>Ø§Ù„Ø£Ø³ØªØ§Ø° Ø§Ù„ÙØ§Ø¶Ù„/ <span id="noteTeacherName" style="font-weight:900">â€”</span> Ø­ÙØ¸Ù‡ Ø§Ù„Ù„Ù‡</p>
            <p><strong>Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ØŒ ÙˆØ¨Ø¹Ø¯ ØŒØŒØŒ</strong></p>
            <p>ÙÙŠ ÙŠÙˆÙ… <span id="noteDay" style="font-weight:900;border-bottom:1px dotted #2f4f4c;padding:0 3mm">â€”</span>
              Ø§Ù„Ù…ÙˆØ§ÙÙ‚ <span id="noteHijri" style="font-weight:900;border-bottom:1px dotted #2f4f4c;padding:0 3mm">â€”</span></p>
            <p id="noteParagraph">
              Ø¥Ø´Ø§Ø±Ø©Ù‹ Ø¥Ù„Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙˆØ§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©Ø› Ù„ÙˆØ­ÙØ¸
              <span id="noteReasonText" style="font-weight:900">Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</span>.
              ÙˆÙ†Ø£Ù…Ù„ Ù…Ù†ÙƒÙ… Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© Ø¨Ù…Ø¹Ø§Ù„Ø¬Ø© Ø°Ù„ÙƒØŒ ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØªØ§Ù… Ø¨Ù…Ø§ ÙŠÙÙˆÙƒÙ„ Ø¥Ù„ÙŠÙƒÙ… Ù…Ù† Ù…Ù‡Ø§Ù…Ø› Ø¯Ø¹Ù…Ù‹Ø§ Ù„Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ù…Ù‡Ù†ÙŠ ÙˆØ±ÙØ¹Ù‹Ø§ Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡.
            </p>
            <p><strong>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ø§Ù„Ø§Ø·Ù„Ø§Ø¹:</strong> ............................... &nbsp;&nbsp; <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ............................... &nbsp;&nbsp; <strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ______ / ______ / 14</p>
            <p><strong>ØªÙˆÙ‚ÙŠØ¹ Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©:</strong> ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</p>
          </div>

          <div class="footer-note"><span>ØªØ­ÙØ¸ ÙÙŠ Ù…Ù„Ù Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</span></div>

        </div>
      </div>
    </div>
  </main>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
<div id="statsDlg" aria-hidden="true" style="display:none">
  <div class="stats-card" id="statsCard">
    <div class="stats-hdr">
      <img id="statsHdrImg" src="hhh.png" alt="Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª" crossorigin="anonymous">
      <div class="stats-meta">
        <div class="rowB" id="statsDay">â€”</div>
        <div class="rowB" id="statsHijri">â€”</div>
      </div>
    </div>
    <div class="h">
      <div style="font-weight:900;color:#064b50">Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
      <div class="stats-actions" style="display:flex;gap:6px">
        <button id="btnResetStats" class="btn ghost" title="ØªØµÙÙŠØ± Ø§Ù„Ø£Ø±Ø´ÙŠÙ">ØªØµÙÙŠØ± Ø§Ù„Ø£Ø±Ø´ÙŠÙ â™»ï¸</button>
        <button id="btnStatsPDF" class="btn primary" title="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
        <button id="btnCloseStats" class="btn ghost">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
    <div style="padding:12px">
      <table id="tblStats" class="tbl2">
        <thead>
          <tr>
            <th>Ø§Ù„Ù…Ø¹Ù„Ù‘Ù…</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ® (Ù‡Ù€)</th><th>Ø§Ù„Ø¹Ø°Ø±</th><th>ÙØ§Ø±Ø³</th><th>ØªÙØ§ØµÙŠÙ„</th><th class="no-print">Ø¥Ø¬Ø±Ø§Ø¡</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot></tfoot>
      </table>
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© -->
<div id="clockDlg" aria-hidden="true">
  <div class="clock-card">
    <div class="h">
      <div style="font-weight:900;color:#064b50">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆÙ‚Øª</div>
      <button id="btnClockClose" class="btn ghost">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <div class="b">
      <div class="clock-big" id="clockPreview">--:--</div>
      <div class="clock-row">
        <div class="col">
          <label style="font-weight:900;color:#03636a">Ø§Ù„Ø³Ø§Ø¹Ø©</label>
          <input id="clockHour" type="range" min="0" max="23" step="1" value="7">
        </div>
        <div class="col">
          <label style="font-weight:900;color:#03636a">Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚</label>
          <input id="clockMin" type="range" min="0" max="59" step="1" value="30">
        </div>
      </div>
      <div class="clock-actions">
        <button id="btnClockNow" class="btn ghost">Ø§Ù„Ø¢Ù†</button>
        <button id="btnClockOk" class="btn primary">Ù…ÙˆØ§ÙÙ‚</button>
      </div>
    </div>
  </div>
</div>
<script>
/* Ø£Ø±Ù‚Ø§Ù… Ø¹Ø±Ø¨ÙŠØ©/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© */
const AR='Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©', EN='0123456789';
const en2ar=s=>(''+s).replace(/[0-9]/g,d=>AR[d]);
const ar2en=s=>(''+s).replace(/[Ù -Ù©]/g,d=>EN[AR.indexOf(d)]);

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† */
const TEACHERS_CSV=`Ù…ÙˆØ³Ù‰ ØµÙ„Ø¨Ø§Ù† Ø¹Ø¨Ø¯Ù‡ Ø¹Ø³ÙŠØ±ÙŠ	1093013116	966507058931	ÙÙŠØ²ÙŠØ§	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ù…Ø¨Ø§Ø±Ùƒ Ø¹ÙˆØ¶Ù‡ Ø³ÙØ± Ø¢Ù„ Ø«Ø§Ø¨Øª	1056464405	966597233399	ÙƒÙŠÙ…ÙŠØ§	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
ÙŠÙˆØ³Ù  Ø¹ÙŠØ³Ù‰ Ø§Ù„Ø¹ÙŠØ¯	1012646822	966592038351	ÙƒÙŠÙ…ÙŠØ§	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø­Ø³Ù† Ø¨Ù† ÙŠÙˆØ³Ù Ø¨Ù† Ø­Ø³ÙŠÙ† Ø§Ù„Ø®Ù„ÙŠÙÙ‡	1056994203	966506907431	Ø§Ø­ÙŠØ§Ø¡	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ù…Ù†Ø°Ø± Ø¹Ø§Ù…Ø± Ø­Ù…ÙˆØ¯ Ø²Ù…ÙŠØ¹	1065913053	966541188974	Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¹Ù…Ø§Ø¯ Ù…Ø­Ù…Ø¯ Ø¬Ù…Ø¹Ø§Ù† Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ	1048667289	966542203039	Ù…ÙƒØªØ¨Ø§Øª	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø­Ø³Ù† ÙŠÙˆØ³Ù Ø­Ø³ÙŠÙ† Ø§Ù„Ø®Ù„ÙŠÙØ©		1056994203	966506907431	ÙƒÙŠÙ…ÙŠØ§Ø¡	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø³Ø§Ù„Ù…ÙŠ	1073861831	966558151033	ÙƒÙŠÙ…ÙŠØ§Ø¡	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø­Ø³Ù† Ø¹Ù„ÙŠ Ø­Ø³Ù† Ø§Ù„Ø´Ù‡Ø±ÙŠ		1037273594	966536824355	Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø­Ø³ÙŠÙ† Ø¨Ù† Ø³Ø¹ÙŠØ¯ Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ù…Ø¯Ù†	1022616799	966556336875	Ù…ÙƒØªØ¨Ø§Øª	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
ÙŠØ­ÙŠÙ‰ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ	1048978892	966555751385	Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
ÙØ±Ø¬ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ù„ÙŠ ÙŠÙˆØ³Ù Ø§Ù„ Ø³ÙŠÙ	1000397735	966504113707	Ø±ÙŠØ§Ø¶ÙŠØ§Øª	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¨Ù†Ø¯Ø± Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ù…Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ	1046853881	966546135135	Ø­Ø§Ø³Ø¨	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø­Ø³ÙŠÙ† Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† ÙÙ‡Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ	1014268567	966504988086	Ø§Ø­ÙŠØ§Ø¡	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ù†Ø§ØµØ± Ø¹Ù„ÙŠ Ù†Ø§ØµØ± Ø§Ù„Ø±Ø§Ø´Ø¯	1008303370	966542933888	Ø­Ø§Ø³Ø¨	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø­Ø³ÙŠÙ† Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø­Ø³ÙŠÙ† Ø§Ù„Ø£Ø­Ù…Ø¯	1060369202	966563740777	Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¹Ù„ÙŠ Ø³Ø¹Ø¯ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø§ØµÙ„Ø¹ÙŠ Ø§Ù„Ø§Ø­Ù…Ø±ÙŠ	1023999780	966590986464	Ø§Ø­ÙŠØ§Ø¡	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø­Ø³Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠ Ø§Ù„Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡	1005472780	966543705512	Ø§Ø­ÙŠØ§Ø¡	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ù…Ø­Ù…Ø¯ Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„ØªÙˆÙŠØ¬Ø±ÙŠ	1064745944	966541381105	Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ÙÙŠØµÙ„ Ø¨Ù† ÙØ·ÙŠØ³ Ø§Ù„Ù‡Ø°Ù„ÙŠ	1094733290	966591585407	Ø±ÙŠØ§Ø¶ÙŠØ§Øª	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­ÙŠÙ… Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ø¨ÙˆØ¹ØµÙŠØ¯Ù‡	1033584234	966546623431	Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø¨Ù† Ø³ÙŠÙ Ø§Ù„Ø³Ù‡Ù„ÙŠ	1063175010	966546221133	Ø¹Ù„Ù… Ø§Ø¬ØªÙ…Ø§Ø¹	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¨Ø´ÙŠØ± Ø¨Ù† Ø£Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¢Ù„ Ø³Ù„ÙŠÙ…	1019783917	966500126925	Ù…ÙƒØªØ¨Ø§Øª	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø§Ù„Ø±Ø¨ÙŠØ¹	1004182687	966548638056	Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø§Ù„Ù… Ø¢Ù„ Ø­Ø¨Ø´Ø§Ù†	1004581359	966500223640	Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø®Ø§Ù„Ø¯ Ø³Ø¹Ø¯ Ø±Ø§Ø´Ø¯ Ø§Ù„Ù…Ø±Ø¶ÙŠ	1025640010	966505877238	Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
ÙÙŠØµÙ„ ÙÙ‡Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ	1086115373	966508448455	Ø±ÙŠØ§Ø¶ÙŠØ§Øª	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø­Ø¨ÙŠØ¨ Ø¹Ø¨Ø¯Ø§Ù„ØºÙ†ÙŠ Ø§Ù„Ù…ÙŠÙ…Ù†ÙŠ	1072815481	966530163027	Ø±ÙŠØ§Ø¶ÙŠØ§Øª	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø²ÙŠØ§Ø¯ Ø¹ÙˆØ§Ø¶ Ø§Ø¨Ù† Ø¹ÙŠØ¶Ù‡ Ø§Ù„Ø¹Ù…Ø±ÙŠ	1092156742	966557530102	Ø¹Ù„Ù… Ø¥Ø¯Ø§Ø±Ø©	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø¹Ø¨Ø¯Ø§Ù„Ø¬Ø¨Ø§Ø± Ø­Ù…ÙˆØ¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ	1089635724	966555741488	ÙÙŠØ²ÙŠØ§	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¬Ù…ÙŠÙ„ Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø¬ÙˆØ§Ø¯ Ø§Ù„Ø¹Ù„ÙŠ		1029281589	966566712113	ÙÙŠØ²ÙŠØ§	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø­Ø³Ù† Ø¹Ù…Ø± Ø§Ù„Ø§Ø¯Ø±ÙŠØ³ÙŠ	1081556910	966533025505	Ø±ÙŠØ§Ø¶ÙŠØ§Øª	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
ØªÙ‚ÙŠ Ø¹Ø¨Ø¯ Ø§Ù„Ù‡Ø§Ø¯ÙŠ ØªÙ‚ÙŠ Ø§Ù„Ø¹Ù„ÙŠ	1026472363	966543219321	ÙƒÙŠÙ…ÙŠØ§	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø®Ø§Ù„Ø¯ Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ	1034318301	966560687900	ÙƒÙŠÙ…ÙŠØ§	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
ØµØ§Ù„Ø­ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† ØµØ§Ù„Ø­ Ø§Ù„Ø³Ù…ÙŠØ­ÙŠ	1003535422	966506921115	Ø¯ÙŠÙ†	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡  Ø®Ù„ÙˆÙØ©  Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„ Ù…Ø±Ø¹ÙŠ		1029490875	966533225515	Ø¯ÙŠÙ†	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¨Ù† Ø£Ø­Ù…Ø¯ Ø¨Ù† Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø§Ù„Ø¹Ø¬Ù„Ø§Ù†	1001082179	966559999808	Ø¯ÙŠÙ†	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¹Ø§Ø¯Ù„ Ø¨Ù† Ø¹Ù„ÙŠ Ø¨Ù† Ù†Ø§ØµØ± Ø§Ù„Ø¨Ø§Ø±Ù‚ÙŠ	1007370701	966530667666	Ø±ÙŠØ§Ø¶Ù‡	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ù†Ø¨ÙŠÙ„ Ø¨Ù† Ù…Ø­Ø³Ù† Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ù‚Ù„Ø§Ù  	1025472604	966562962766	Ø±ÙŠØ§Ø¶Ù‡	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
Ø¹Ø§Ø¯Ù„ Ø¨Ù† Ø¹Ù„ÙŠ Ø¨Ù† Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø³Ø¨Ø¹Ø§Ù†	1005472780	966504836200	Ù…ÙˆØ¬Ù‡ Ø·Ù„Ø§Ø¨ÙŠ	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
ÙŠØ§Ø³Ø± Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø§Ù„Ù†Ù…Ø±	1001443397	966503834833	Ù…Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª	Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¹Ù„Ù…
Ø¹Ù„ÙŠ Ø¨Ù† Ø­Ø³Ù† Ø¨Ù† Ø¹Ù„ÙŠ Ø¢Ù„ Ù‚Ù…Ø¨Ø±	1004780860	966502085389	Ø³ÙƒØ±ØªØ§Ø±ÙŠÙ‡	Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¹Ù„Ù…
Ø­Ø³Ù† Ø¨Ù† Ø¹Ø§Ù…Ø± Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ	1013124175	966598893731	Ù…Ø­Ø¶Ø± Ù…Ø®ØªØ¨Ø±	Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¹Ù„Ù…
Ø¹Ø¯Ù†Ø§Ù† Ø¹Ù„ÙŠ Ø­Ø³ÙŠÙ† Ø§Ù„Ø²Ø±ÙŠÙ‚	1015776766	966505808451	ÙˆÙƒÙŠÙ„	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³
ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ	1024193532	966504532489	Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©	Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³`;

function parseTeachersCSV(csv){
  return csv.trim().split(/\r?\n/).map(line=>{
    const parts=line.split(/\t+/);
    const [name,civil,phone,spec,level]=[parts[0]||'',parts[1]||'',parts[2]||'',parts[3]||'',parts[4]||''];
    return {name:name.trim(), civil:(civil||'').trim(), phone:(phone||'').replace(/[^\d]/g,''), spec:spec.trim(), level:level.trim(), job:'', work:'Ù…Ø¹Ù„Ù…'};
  }).filter(r=>r.name);
}
const TEACHERS=parseTeachersCSV(TEACHERS_CSV);

/* ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† */
const selTeacher=document.getElementById('selTeacher');
function fillTeachers(){ selTeacher.innerHTML='<option value="">â€” Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù…Ø§Ù‹ â€”</option>'; TEACHERS.forEach((t,i)=>selTeacher.add(new Option(t.name,i))) }
fillTeachers();

/* Ø­Ø§Ù„Ø© Ø¹Ø§Ù…Ø© + Ø£Ø±Ø´ÙŠÙ */
let STATE={kind:'late',excuse:'without',accept:'rejected',faris:''}; // faris ÙÙ‚Ø· Ù„Ù…Ø³Ø§Ø¡Ù„Ø© Ø§Ù„ØºÙŠØ§Ø¨
const KEY_ARCH='followup_archive_v10';
let ARCH=JSON.parse(localStorage.getItem(KEY_ARCH)||'[]');
function saveARCH(){ localStorage.setItem(KEY_ARCH, JSON.stringify(ARCH)); }
function clearARCH(){ ARCH=[]; saveARCH(); }
function nextSerialFor(civil){ const n=ARCH.filter(e=>e.civil===civil).length+1; return en2ar(String(n).padStart(2,'0')); }

/* Ø¹Ù†Ø§ØµØ± Ø£Ù‚Ø³Ø§Ù… */
const alertPack=document.getElementById('alertPack');
const absencePack=document.getElementById('absencePack');
const notePack=document.getElementById('notePack');
const lineLate=document.getElementById('lineLate');
const lineAbs=document.getElementById('lineAbs');
const lineEarly=document.getElementById('lineEarly');
const kindTitle=document.getElementById('kindTitle');
const statsDlg=document.getElementById('statsDlg');

/* Ù†Ø·Ø§Ù‚ Ø¯ÙˆØ§Ù… + Ù…Ø­ÙˆÙ‘Ù„ Ø§Ù„Ù…ÙˆØ³Ù… â€” Ø§Ù„Ø´ØªÙˆÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠ (07:00â€“14:00)ØŒ Ø§Ù„ØµÙŠÙÙŠ (06:45â€“13:45) */
const WORK_RANGE={ winter:{start:'07:00',end:'14:00'}, summer:{start:'06:45',end:'13:45'} };
let SEASON='winter';
document.getElementById('seasonChips').addEventListener('click',e=>{
  const b=e.target.closest('.chip'); if(!b) return;
  [...e.currentTarget.children].forEach(x=>x.classList.remove('active')); b.classList.add('active');
  SEASON=b.dataset.season; recalc();
});

/* Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ + Ø§Ù„ØªØ­ÙƒÙ… Ø¨ÙØ§Ø±Ø³ */
function setPack(kind){
  STATE.kind=kind;
  document.getElementById('mainTitle').textContent=({late:'ØªÙ†Ø¨ÙŠÙ‡',absent:'ØªÙ†Ø¨ÙŠÙ‡',early:'ØªÙ†Ø¨ÙŠÙ‡',gaib:'Ù…Ø³Ø§Ø¡Ù„Ø© ØºÙŠØ§Ø¨',note:'Ù„ÙØª Ù†Ø¸Ø±'})[kind];
  alertPack.style.display=(kind==='gaib'||kind==='note')?'none':'';
  document.getElementById('affidavitPack').style.display=(kind==='gaib'||kind==='note')?'none':'';
  document.getElementById('principalPack').style.display=(kind==='gaib'||kind==='note')?'none':'';
  absencePack.style.display=(kind==='gaib')?'':'none';
  notePack.style.display=(kind==='note')?'':'none';
  lineLate.style.display=(kind==='late')?'':'none';
  lineAbs.style.display=(kind==='absent')?'':'none';
  lineEarly.style.display=(kind==='early')?'':'none';
  kindTitle.textContent=({late:'ØªØ£Ø®Ø±',absent:'Ø¹Ø¯Ù… ØªÙˆØ§Ø¬Ø¯',early:'Ø§Ù†ØµØ±Ø§Ù Ù…Ø¨ÙƒØ±'})[kind]||'â€”';
  document.getElementById('affKind').textContent=({late:'Ø§Ù„ØªØ£Ø®Ø±',absent:'Ø¹Ø¯Ù… Ø§Ù„ØªÙˆØ§Ø¬Ø¯',early:'Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…Ø¨ÙƒØ±'})[kind]||'Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©';

  // ÙØ§Ø±Ø³ ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· ÙÙŠ Ù…Ø³Ø§Ø¡Ù„Ø© Ø§Ù„ØºÙŠØ§Ø¨
  const frWrap=document.getElementById('frGroup').parentElement;
  if(kind==='gaib'){ frWrap.classList.remove('disabled'); if(!STATE.faris) STATE.faris='not'; }
  else { frWrap.classList.add('disabled'); STATE.faris=''; }

  updUnifiedText();
  if(kind==='gaib') updatePrincipalAbs();
}
document.getElementById('kindChips').addEventListener('click',e=>{
  const b=e.target.closest('.chip'); if(!b) return;
  [...e.currentTarget.children].forEach(x=>x.classList.remove('active')); b.classList.add('active');
  setPack(b.dataset.k); recalc();
});

/* Ø§Ù„Ù…ÙˆØ­Ù‘Ø¯: Ø§Ù„Ø¹Ø°Ø±/Ø§Ù„Ù‚Ø¨ÙˆÙ„/ÙØ§Ø±Ø³ */
const unifiedPanel=document.getElementById('unifiedPanel'), unifiedText=document.getElementById('unifiedText');
document.getElementById('btnUnified').onclick=()=> unifiedPanel.style.display=unifiedPanel.style.display?'':'block';
unifiedPanel.addEventListener('click',e=>{
  const c=e.target.closest('.chip'); if(!c) return;
  if(c.dataset.exc){ c.parentElement.querySelectorAll('[data-exc]').forEach(x=>x.classList.remove('active')); c.classList.add('active'); STATE.excuse=c.dataset.exc; }
  if(c.dataset.acc){ c.parentElement.querySelectorAll('[data-acc]').forEach(x=>x.classList.remove('active')); c.classList.add('active'); STATE.accept=c.dataset.acc; }
  if(c.dataset.fr && STATE.kind==='gaib'){ c.parentElement.querySelectorAll('[data-fr]').forEach(x=>x.classList.remove('active')); c.classList.add('active'); STATE.faris=c.dataset.fr; }
  updUnifiedText();
});
function updUnifiedText(){
  const excTxt=(STATE.excuse==='with')?'Ø¨Ø¹Ø°Ø±':'Ø¨Ø¯ÙˆÙ† Ø¹Ø°Ø±';
  const frTxt=(STATE.kind==='gaib')?(' â€¢ ÙØ§Ø±Ø³: '+(STATE.faris==='raised'?'Ù…Ø±ÙÙˆØ¹':'Ù„Ù… ÙŠÙØ±ÙØ¹')):'';
  unifiedText.textContent=excTxt+frTxt;
}

/* Ø§Ù„ØªØ§Ø±ÙŠØ®: Ù‡Ø¬Ø±ÙŠ/Ù…ÙŠÙ„Ø§Ø¯ÙŠ */
let CAL_MODE='h';
const pickHijri=document.getElementById('pickHijri'), pickGreg=document.getElementById('pickGreg');
document.getElementById('btnCalToggle').onclick=()=>{
  CAL_MODE=CAL_MODE==='h'?'g':'h';
  document.getElementById('btnCalToggle').textContent=(CAL_MODE==='h'?'ğŸ—“ï¸ Ù‡Ø¬Ø±ÙŠ':'ğŸ—“ï¸ Ù…ÙŠÙ„Ø§Ø¯ÙŠ');
  pickHijri.style.display=CAL_MODE==='h'?'flex':'none';
  pickGreg.style.display=CAL_MODE==='g'?'flex':'none';
  if(CAL_MODE==='h') syncFromHijri(); else syncFromGregInputs();
};
function hijriToGregorian(y,m,d){
  let lo=new Date(1937,0,1), hi=new Date(2077,11,31);
  const fmt=new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura',{year:'numeric',month:'numeric',day:'numeric'});
  const parts=dt=>{const p=fmt.formatToParts(dt);return{y:+ar2en(p.find(x=>x.type==='year').value),m:+ar2en(p.find(x=>x.type==='month').value),d:+ar2en(p.find(x=>x.type==='day').value)}};
  while(lo<=hi){const mid=new Date((lo.getTime()+hi.getTime())/2),v=parts(mid);
    if(v.y===y&&v.m===m&&v.d===d) return new Date(mid.getFullYear(),mid.getMonth(),mid.getDate());
    if(v.y<y||(v.y===y&&v.m<m)||(v.y===y&&v.m===m&&v.d<d)) lo=new Date(mid.getFullYear(),mid.getMonth(),mid.getDate()+1);
    else hi=new Date(mid.getFullYear(),mid.getMonth(),mid.getDate()-1);}
  return new Date();
}
function buildHijriPicker(){
  const y=document.getElementById('hY'),m=document.getElementById('hM'),d=document.getElementById('hD');
  y.innerHTML=m.innerHTML=d.innerHTML='';
  const now=new Date(); const currAH=parseInt(ar2en(new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura',{year:'numeric'}).format(now)),10);
  for(let i=currAH-1;i<=currAH+1;i++) y.add(new Option(en2ar(i),i));
  for(let i=1;i<=12;i++) m.add(new Option(en2ar(String(i).padStart(2,'0')),i));
  for(let i=1;i<=30;i++) d.add(new Option(en2ar(String(i).padStart(2,'0')),i));
  const parts=new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura',{year:'numeric',month:'2-digit',day:'2-digit'}).formatToParts(now);
  d.value=+ar2en(parts.find(p=>p.type==='day').value); m.value=+ar2en(parts.find(p=>p.type==='month').value); y.value=+ar2en(parts.find(p=>p.type==='year').value);
  y.onchange=m.onchange=d.onchange=syncFromHijri; syncFromHijri();
}
function syncFromHijri(){
  const y=+hY.value, m=+hM.value, d=+hD.value;
  const g=hijriToGregorian(y,m,d);
  const dayName=new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura',{weekday:'long'}).format(g);
  const hij=new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura',{year:'numeric',month:'2-digit',day:'2-digit'}).format(g);
  metaDay.textContent=dayName; metaHijri.textContent=hij;
  dynDay.textContent=dayName; dynHijri.textContent=hij;
  noteDay.textContent=dayName; noteHijri.textContent=hij;
  document.getElementById('affTeacher').textContent=document.getElementById('t_name').textContent||'â€”';
  document.getElementById('absDayP').textContent=dayName;
  document.getElementById('absDateYMD').textContent=hij;
  document.getElementById('statsDay').textContent=dayName;
  document.getElementById('statsHijri').textContent=hij;
  updatePrincipalAbs();
}
['gY','gM','gD'].forEach(id=>document.getElementById(id).addEventListener('input',syncFromGregInputs));
function syncFromGregInputs(){
  const y=+gY.value||new Date().getFullYear(), m=+gM.value||new Date().getMonth()+1, d=+gD.value||new Date().getDate();
  const g=new Date(y,m-1,d);
  const dayName=new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura',{weekday:'long'}).format(g);
  const hij=new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura',{year:'numeric',month:'2-digit',day:'2-digit'}).format(g);
  metaDay.textContent=dayName; metaHijri.textContent=hij;
  dynDay.textContent=dayName; dynHijri.textContent=hij;
  noteDay.textContent=dayName; noteHijri.textContent=hij;
  document.getElementById('affTeacher').textContent=document.getElementById('t_name').textContent||'â€”';
  document.getElementById('absDayP').textContent=dayName;
  document.getElementById('absDateYMD').textContent=hij;
  document.getElementById('statsDay').textContent=dayName;
  document.getElementById('statsHijri').textContent=hij;
  updatePrincipalAbs();
}

/* ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„ÙˆÙ‚Øª */
function toMin(hhmm){ const m=/^(\d{1,2}):(\d{2})$/.exec(ar2en(hhmm||'')); if(!m) return null; const h=+m[1], mi=+m[2]; if(h>23||mi>59) return null; return h*60+mi; }
function fmtHM(mins){ const h=Math.floor(mins/60), m=mins%60; return en2ar(String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')); }

/* Ù‚Ù†Ø§Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ + Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© */
function attachTimeMask(el){
  el.addEventListener('beforeinput', (e)=>{ if(e.inputType==='insertText'){ const ch=e.data; if(!(/[0-9Ù -Ù©:]/.test(ch))) e.preventDefault(); }});
  el.addEventListener('input', ()=>{
    let v=el.textContent.replace(/[^0-9Ù -Ù©]/g,''); v=ar2en(v);
    if(v.length>=3){ v=v.slice(0,4).padEnd(4,'0'); v=v.slice(0,2)+':'+v.slice(2,4);} else if(v.length>0){ v=v.padEnd(2,'0'); }
    el.textContent=en2ar(v.length?v:'--:--'); if(el.textContent.includes(':')) el.classList.remove('empty'); placeCaretAtEnd(el); recalc();
  });
  el.addEventListener('blur', ()=>{ const m=toMin(el.textContent); if(m==null){ el.textContent='--:--'; el.classList.add('empty'); } else { el.textContent=fmtHM(m); el.classList.remove('empty'); } recalc(); });
  el.addEventListener('click', ()=> openClock(el));
}
function placeCaretAtEnd(el){ const r=document.createRange(); r.selectNodeContents(el); r.collapse(false); const s=window.getSelection(); s.removeAllRanges(); s.addRange(r); }
['tLateIn','tAbsFrom','tAbsTo','tEarlyFrom'].forEach(id=>attachTimeMask(document.getElementById(id)));

let CLOCK_TARGET=null;
const clockDlg=document.getElementById('clockDlg');
const clockHour=document.getElementById('clockHour');
const clockMin=document.getElementById('clockMin');
const clockPreview=document.getElementById('clockPreview');
function showClock(){ clockDlg.style.display='flex'; clockDlg.setAttribute('aria-hidden','false'); }
function hideClock(){ clockDlg.style.display='none'; clockDlg.setAttribute('aria-hidden','true'); CLOCK_TARGET=null; }
function updClockPreview(){ clockPreview.textContent=en2ar(String(clockHour.value).padStart(2,'0')+':'+String(clockMin.value).padStart(2,'0')); }
function openClock(target){
  CLOCK_TARGET=target;
  const cur=toMin(target.textContent); const now=new Date();
  const h=(cur!=null)?Math.floor(cur/60):now.getHours();
  const m=(cur!=null)?(cur%60):now.getMinutes();
  clockHour.value=h; clockMin.value=m; updClockPreview(); showClock();
}
clockHour.addEventListener('input',updClockPreview);
clockMin.addEventListener('input',updClockPreview);
document.getElementById('btnClockNow').onclick=()=>{ const now=new Date(); clockHour.value=now.getHours(); clockMin.value=now.getMinutes(); updClockPreview(); };
document.getElementById('btnClockOk').onclick=()=>{ if(!CLOCK_TARGET) return; const m=+clockMin.value, h=+clockHour.value; CLOCK_TARGET.textContent=en2ar(String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')); CLOCK_TARGET.classList.remove('empty'); hideClock(); recalc(); };
document.getElementById('btnClockClose').onclick=hideClock;
clockDlg.addEventListener('click',(e)=>{ if(e.target===clockDlg) hideClock(); });

/* Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ */
function recalc(){
  const wsM=toMin(WORK_RANGE[SEASON].start), weM=toMin(WORK_RANGE[SEASON].end);
  const tLate=document.getElementById('tLateIn').textContent.trim(); const tLateM=toMin(tLate);
  if(tLateM!=null&&wsM!=null&&tLateM>wsM){ const mins=tLateM-wsM; lateTotal.textContent=en2ar(mins)+' Ø¯Ù‚ÙŠÙ‚Ø©'; lateHH.textContent=fmtHM(mins); } else { lateTotal.textContent='0 Ø¯Ù‚ÙŠÙ‚Ø©'; lateHH.textContent='00:00'; }
  const aF=document.getElementById('tAbsFrom').textContent.trim(), aT=document.getElementById('tAbsTo').textContent.trim();
  const aFM=toMin(aF), aTM=toMin(aT);
  if(aFM!=null&&aTM!=null&&aTM>aFM){ const mins=aTM-aFM; absTotal.textContent=en2ar(mins)+' Ø¯Ù‚ÙŠÙ‚Ø©'; absHH.textContent=fmtHM(mins);} else { absTotal.textContent='0 Ø¯Ù‚ÙŠÙ‚Ø©'; absHH.textContent='00:00'; }
  const eF=document.getElementById('tEarlyFrom').textContent.trim(); const eFM=toMin(eF);
  if(eFM!=null&&weM!=null&&weM>eFM){ const mins=weM-eFM; earlyTotal.textContent=en2ar(mins)+' Ø¯Ù‚ÙŠÙ‚Ø©'; earlyHH.textContent=fmtHM(mins);} else { earlyTotal.textContent='0 Ø¯Ù‚ÙŠÙ‚Ø©'; earlyHH.textContent='00:00'; }
}

/* Ø³Ø¨Ø¨ Ù„ÙØª Ø§Ù„Ù†Ø¸Ø± */
document.getElementById('noteReason').addEventListener('change', e=>{
  document.getElementById('noteReasonText').textContent=e.target.value||'Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©';
});

/* ØªØ·Ø¨ÙŠÙ‚ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… + Ø§Ù„Ø±Ù‚Ù… */
selTeacher.addEventListener('change',e=>{
  const i=+e.target.value; const t=Number.isInteger(i)?TEACHERS[i]:null; if(!t) return;
  t_name.textContent=t.name||'â€”'; t_spec.textContent=t.spec||'â€”'; t_level.textContent=t.level||'â€”';
  t_job.textContent=t.job||'â€”'; t_work.textContent=t.work||'â€”'; t_civil.textContent=t.civil||'â€”';
  teacherNameInline.textContent=t.name||'â€”'; noteTeacherName.textContent=t.name||'â€”'; document.getElementById('affTeacher').textContent=t.name||'â€”';
  document.getElementById('abs-name-top').textContent=t.name||'â€”'; document.getElementById('abs-teacher-name').textContent=t.name||'â€”';
  metaNo.textContent=nextSerialFor(t.civil);
  updatePrincipalAbs();
});

/* ÙˆØ§ØªØ³Ø§Ø¨ */
document.getElementById('btnWA').addEventListener('click', ()=>{
  const i=+selTeacher.value; if(!Number.isInteger(i)) return alert('Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù…Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹');
  const t=TEACHERS[i]; const kind=STATE.kind;
  const kindLabel={late:'ØªÙ†Ø¨ÙŠÙ‡ ØªØ£Ø®Ø±',absent:'ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø¯Ù… ØªÙˆØ§Ø¬Ø¯',early:'ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù†ØµØ±Ø§Ù Ù…Ø¨ÙƒØ±',gaib:'Ù…Ø³Ø§Ø¡Ù„Ø© ØºÙŠØ§Ø¨',note:'Ù„ÙØª Ù†Ø¸Ø±'}[kind];
  let details='';
  if(kind==='late'){ details=`ØªØ£Ø®Ù‘Ø± Ø¹Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù…ØŒ ÙˆÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±: ${document.getElementById('tLateIn').textContent.trim()}Ø› Ù†Ø£Ù…Ù„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø¨Ø¨ ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„.`; }
  else if(kind==='absent'){ details=`Ø¹Ø¯Ù… ØªÙˆØ§Ø¬Ø¯ Ø®Ù„Ø§Ù„ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¯ÙˆØ§Ù…Ø› Ù†Ø£Ù…Ù„ Ø¥ÙŠØ¶Ø§Ø­ Ø§Ù„Ø³Ø¨Ø¨ ÙˆØ¥Ø±ÙØ§Ù‚ Ù…Ø§ ÙŠØ¤ÙŠØ¯Ù‡.`; }
  else if(kind==='early'){ details=`Ø§Ù†ØµØ±Ø§Ù Ù‚Ø¨Ù„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù…Ø› Ù†Ø£Ù…Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø±Ø³Ù…ÙŠ.`; }
  else if(kind==='gaib'){ details=`ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù…Ø³Ø§Ø¡Ù„Ø© ØºÙŠØ§Ø¨ Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ù…ÙˆØ¶Ù‘Ø­.`; }
  else if(kind==='note'){ details=`Ù„ÙØª Ù†Ø¸Ø± Ø¨Ø³Ø¨Ø¨: ${document.getElementById('noteReasonText').textContent.trim()}`; }
  const msg=`Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…
${kindLabel}
Ø§Ù„Ø§Ø³Ù…: ${t.name}
Ø§Ù„ÙŠÙˆÙ…: ${metaDay.textContent}
Ø§Ù„ØªØ§Ø±ÙŠØ® (Ù‡Ù€): ${metaHijri.textContent}
${details}
*Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©*`;
  window.open(`https://wa.me/${t.phone||'966500000000'}?text=${encodeURIComponent(msg)}`,'_blank');
});

/* ØªØ¶Ù…ÙŠÙ† Ø§Ù„ØµÙˆØ± (Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù‡ÙŠØ¯Ø± ÙÙŠ PDF ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©) */
async function embedImageToDataURL(imgEl){
  try{
    const src=imgEl.getAttribute('src')||''; if(!src) return;
    const u=src.match(/^data:/)? src : encodeURI(src);
    const resp=await fetch(u,{mode:'cors',cache:'no-store'}); if(!resp.ok) return;
    const blob=await resp.blob(); const reader=new FileReader();
    await new Promise(res=>{ reader.onload=()=>{ imgEl.src=reader.result; res(); }; reader.readAsDataURL(blob); });
  }catch(e){}
}
async function ensureAllImagesEmbedded(root){
  const imgs=[...root.querySelectorAll('img')];
  for(const im of imgs){ if(!im.src.startsWith('data:')) await embedImageToDataURL(im); }
}

/* Ø·Ø¨Ø§Ø¹Ø©/Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
document.getElementById('btnPrintSave').addEventListener('click', async function(){
  const i=+selTeacher.value; if(!Number.isInteger(i)) { alert('Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù…Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹'); return; }
  const t=TEACHERS[i];
  ARCH.push({ ts:Date.now(), civil:t.civil, name:t.name, kind:STATE.kind, excuse:STATE.excuse, accept:STATE.accept, faris:(STATE.kind==='gaib'?(STATE.faris||'not'):''), hijri:metaHijri.textContent, day:metaDay.textContent });
  saveARCH();

  const { jsPDF }=window.jspdf;
  const btn=this; const old=btn.textContent; btn.disabled=true; btn.textContent='Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ PDF...';
  try{
    const sheet=document.getElementById('sheet');
    await ensureAllImagesEmbedded(sheet);
    const canvas=await html2canvas(sheet,{ scale:2, background:'#fff', useCORS:true, allowTaint:false, imageTimeout:0, logging:false });
    const pdf=new jsPDF({orientation:'p',unit:'mm',format:'a4'});
    const w=210,h=canvas.height*210/canvas.width;
    pdf.addImage(canvas.toDataURL('image/png'),'PNG',0,0,w,h);
    pdf.save(`Ø¥Ø¬Ø±Ø§Ø¡ - ${t.name}.pdf`);
    setTimeout(()=>window.print(),200);
  }catch(err){ alert('ØªØ¹Ø°Ù‘Ø± Ø¥Ù†Ø´Ø§Ø¡ PDF: '+(err.message||err)); }
  finally{ btn.disabled=false; btn.textContent=old; }
});

/* Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª â€” Ø§Ù„Ù‡ÙŠØ¯Ø± + Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙ‚Ø·ØŒ Ø¨Ø¯ÙˆÙ† Ø£Ø²Ø±Ø§Ø±/Ø­Ø°Ù */
document.getElementById('btnStatsPDF').onclick=async()=>{
  const dlg=document.getElementById('statsDlg');
  const card=document.getElementById('statsCard');
  await ensureAllImagesEmbedded(card);
  dlg.setAttribute('aria-hidden','false');
  document.body.setAttribute('data-print','stats');
  window.print();
  setTimeout(()=>document.body.removeAttribute('data-print'),300);
};

/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
document.getElementById('btnStats').onclick=openStats;
document.getElementById('btnCloseStats').onclick=()=>{ statsDlg.style.display='none'; statsDlg.setAttribute('aria-hidden','true'); };
document.getElementById('btnResetStats').onclick=()=>{ if(confirm('ØªØ£ÙƒÙŠØ¯: Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ø§Ù„Ø£Ø±Ø´ÙŠÙØŸ')){ clearARCH(); openStats(); } };

function shortDetails(r){
  if(r.kind==='late'){ const txt=document.getElementById('lateTotal')?.textContent||'0 Ø¯Ù‚ÙŠÙ‚Ø©'; return `ØªØ£Ø®Ø± ${txt.replace(/[^\dÙ -Ù©]/g,'').trim()}Ø¯`; }
  if(r.kind==='absent'){ const a=document.getElementById('absTotal')?.textContent||'0 Ø¯Ù‚ÙŠÙ‚Ø©'; return `Ø¹Ø¯Ù… ØªÙˆØ§Ø¬Ø¯ ${a.replace(/[^\dÙ -Ù©]/g,'').trim()}Ø¯`; }
  if(r.kind==='early'){ const e=document.getElementById('earlyTotal')?.textContent||'0 Ø¯Ù‚ÙŠÙ‚Ø©'; return `Ø§Ù†ØµØ±Ø§Ù ${e.replace(/[^\dÙ -Ù©]/g,'').trim()}Ø¯`; }
  if(r.kind==='gaib'){ return `ØºÙŠØ§Ø¨`; }
  if(r.kind==='note'){ const rs=document.getElementById('noteReasonText')?.textContent||'â€”'; return `Ù„ÙØª Ù†Ø¸Ø± â€” ${rs}`; }
  return 'â€”';
}
function openStats(){
  const tb=document.querySelector('#tblStats tbody'); tb.innerHTML='';
  const byTeacher=new Map(); ARCH.forEach(r=>{const k=r.civil||r.name; if(!byTeacher.has(k)) byTeacher.set(k,{name:r.name,rows:[]}); byTeacher.get(k).rows.push(r);});
  for(const {name,rows} of byTeacher.values()){
    rows.sort((a,b)=>a.ts-b.ts);
    rows.forEach((r,idx)=>{
      const tr=document.createElement('tr');
      if(idx===0){ const td=document.createElement('td'); td.rowSpan=rows.length; td.style.fontWeight='900'; td.textContent=name; tr.appendChild(td); }
      tr.innerHTML += `
        <td>${({late:'ØªÙ†Ø¨ÙŠÙ‡ ØªØ£Ø®Ø±',absent:'ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø¯Ù… ØªÙˆØ§Ø¬Ø¯',early:'ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù†ØµØ±Ø§Ù Ù…Ø¨ÙƒØ±',gaib:'Ù…Ø³Ø§Ø¡Ù„Ø© ØºÙŠØ§Ø¨',note:'Ù„ÙØª Ù†Ø¸Ø±'})[r.kind]}</td>
        <td>${r.day}</td>
        <td>${r.hijri}</td>
        <td>${r.excuse==='with'?'Ø¨Ø¹Ø°Ø±':'Ø¨Ø¯ÙˆÙ† Ø¹Ø°Ø±'}</td>
        <td>${r.kind==='gaib' ? ((r.faris==='raised')?'Ù…Ø±ÙÙˆØ¹':'Ù„Ù… ÙŠÙØ±ÙØ¹') : ''}</td>
        <td>${shortDetails(r)}</td>
        <td class="no-print"><button class="btn ghost delRow" data-ts="${r.ts}" title="Ø­Ø°Ù">Ø­Ø°Ù</button></td>`;
      tb.appendChild(tr);
    });
  }
  statsDlg.style.display='flex';
  statsDlg.setAttribute('aria-hidden','false');
  document.getElementById('statsDay').textContent=document.getElementById('metaDay').textContent;
  document.getElementById('statsHijri').textContent=document.getElementById('metaHijri').textContent;
}
document.getElementById('tblStats').addEventListener('click', (e)=>{
  const btn=e.target.closest('.delRow'); if(!btn) return;
  const ts=+btn.dataset.ts; if(!Number.isFinite(ts)) return;
  if(confirm('ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')){
    const idx=ARCH.findIndex(r=>r.ts===ts);
    if(idx>-1){ ARCH.splice(idx,1); saveARCH(); openStats(); }
  }
});

/* ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ± ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¡Ù„Ø© â€” Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Ù‹ */
const PRINCIPAL_NAME='ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ';
function updatePrincipalAbs(){
  const nameEl=document.getElementById('principalNameAbs');
  const signEl=document.getElementById('principalSignAbs');
  const dateEl=document.getElementById('principalDateAbs');
  if(!nameEl||!dateEl||!signEl) return;
  nameEl.textContent=PRINCIPAL_NAME;
  signEl.textContent='____________________';
  dateEl.textContent=document.getElementById('metaHijri').textContent||'â€”';
}

/* ØªÙ‡ÙŠØ¦Ø© */
function init(){
  buildHijriPicker();
  setPack('late');     // Ø§ÙØªØ±Ø§Ø¶ÙŠ
  SEASON='winter';     // Ø§Ù„Ø´ØªÙˆÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠ
  document.getElementById('sidebar').style.pointerEvents='auto';
  statsDlg.style.display='none';
  document.getElementById('clockDlg').style.display='none';
  updatePrincipalAbs();
}
init();
</script>
</body>
</html>

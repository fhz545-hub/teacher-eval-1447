<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ØªØ­Ù„ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ù…Ù† Ù…Ù„ÙØ§Øª Ø­Ø¶ÙˆØ±ÙŠ â€“ Excel</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
:root{
  --moe:#0b7e88;
  --moe-soft:#e1f3f1;
  --ink:#0b2f2b;
  --muted:#6b7280;
  --bg:#f3f7f8;
  --card:#ffffff;
  --line:#dde7e8;
  --danger:#dc2626;
  --warn:#f59e0b;
  --ok:#16a34a;
}
*{box-sizing:border-box}
html,body{
  margin:0;
  padding:0;
  font-family:"Tajawal",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--ink);
}
body{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:16px 8px 40px;
}

/* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³Ø© */
.shell{
  width:100%;
  max-width:1150px;
  background:#f9fbfb;
  border-radius:22px;
  box-shadow:0 18px 40px rgba(0,0,0,.08);
  overflow:hidden;
  border:1px solid rgba(11,126,136,.14);
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ */
header{
  position:relative;
  background:radial-gradient(circle at 0% 0%,#15aabf,#0b7e88 55%,#064f55 100%);
  color:#fff;
  padding:10px 18px 16px;
  display:flex;
  flex-wrap:wrap;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
}
.header-main{display:block;}
header h1{
  margin:0;
  font-size:1.25rem;
  font-weight:800;
}
header p{
  margin:2px 0 0;
  font-size:.9rem;
  opacity:.95;
}
.badge-pill{
  margin-top:4px;
  align-self:flex-start;
  padding:3px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.65);
  font-size:.78rem;
  display:inline-flex;
  align-items:center;
  gap:6px;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± */
.header-controls{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:6px;
}

/* Ø²Ø± Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ */
.import-btn{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:7px 12px;
  border-radius:999px;
  background:#fff;
  color:#0b7e88;
  font-size:.86rem;
  font-weight:700;
  border:none;
  cursor:pointer;
  box-shadow:0 8px 20px rgba(0,0,0,.18);
}
.import-btn span.icon{
  width:22px;
  height:22px;
  border-radius:50%;
  background:rgba(11,126,136,.12);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.05rem;
}
.import-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 12px 26px rgba(0,0,0,.22);
}
.import-btn input[type="file"]{display:none;}

/* Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ: Ø§Ù„ÙƒÙ„ ÙÙŠ ØµÙ ÙˆØ§Ø­Ø¯ */
.top-row{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  justify-content:flex-start;
  gap:6px;
}

/* Ø­Ù‚Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® */
.date-chip{
  display:inline-flex;
  align-items:center;
  gap:4px;
  padding:3px 8px;
  border-radius:999px;
  background:rgba(255,255,255,.18);
  font-size:.8rem;
}
.date-chip input{
  border:none;
  border-radius:16px;
  padding:2px 6px;
  font-family:"Tajawal",sans-serif;
  font-size:.8rem;
}

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØºÙŠØ§Ø¨/Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ†/Ø§Ù„Ø§Ù†ØµØ±Ø§Ù */
.filter-btn{
  border:none;
  border-radius:999px;
  padding:3px 9px;
  font-size:.78rem;
  font-family:"Tajawal",sans-serif;
  display:inline-flex;
  align-items:center;
  gap:4px;
  cursor:pointer;
  background:#ffffff;
  color:#064f55;
}
.filter-btn span.count{
  background:#0b7e88;
  color:#fff;
  border-radius:10px;
  padding:0 6px;
  font-size:.75rem;
}

/* Ø²Ø± Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
.print-btn{
  border:none;
  border-radius:999px;
  padding:4px 10px;
  font-size:.8rem;
  font-family:"Tajawal",sans-serif;
  display:inline-flex;
  align-items:center;
  gap:4px;
  cursor:pointer;
  background:#0f172a;
  color:#fff;
}

/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© */
.main{
  padding:10px 14px 16px;
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
.official-header{
  display:flex;
  flex-wrap:wrap;
  justify-content:space-between;
  align-items:flex-start;
  gap:8px;
  padding:8px 10px;
  background:#ffffff;
  border-radius:14px;
  border:1px solid var(--line);
  margin-bottom:8px;
}
.official-lines p{
  margin:0;
  font-size:.78rem;
  color:#0b3f43;
}
.official-lines p:first-child{font-weight:700;}
.official-side{
  text-align:left;
  font-size:.76rem;
}
.official-side p{
  margin:0 0 2px;
}
.official-note{
  color:var(--muted);
  max-width:340px;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„ÙˆØµÙ */
.info-bar{
  font-size:.8rem;
  color:var(--muted);
  margin:6px 0 8px;
  display:flex;
  justify-content:space-between;
  gap:8px;
  flex-wrap:wrap;
}
.info-bar span.label{
  font-weight:600;
  color:#0b3f43;
}

/* Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ */
.table-wrapper{
  width:100%;
  overflow:hidden;
  border-radius:16px;
  border:1px solid var(--line);
  background:#fff;
}
table{
  width:100%;
  border-collapse:collapse;
  table-layout:fixed;
  font-size:.78rem;
}
thead{
  background:#0b7e88;
  color:#fff;
}
th,td{
  padding:4px 4px;
  border-bottom:1px solid #edf3f3;
  white-space:nowrap;
  text-align:center;
}
th{
  font-weight:700;
}
tbody tr:nth-child(even){background:#f8fbfb;}
tbody tr:hover{background:#eaf6f6;}
.empty-msg{
  padding:16px;
  text-align:center;
  font-size:.85rem;
  color:var(--muted);
}

/* Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© */
.badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:2px 6px;
  border-radius:999px;
  font-size:.72rem;
  border:1px solid rgba(11,126,136,.4);
  background:#e5f6f6;
  color:var(--moe);
}
.badge-ok{
  border-color:rgba(22,163,74,.5);
  background:#e3ffe9;
  color:var(--ok);
}
.badge-warn{
  border-color:rgba(245,158,11,.7);
  background:#fff7e6;
  color:var(--warn);
}
.badge-danger{
  border-color:rgba(220,38,38,.7);
  background:#fee2e2;
  color:var(--danger);
}

/* ØªØ¶ÙŠÙŠÙ‚ Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ Ù„ØµÙØ­Ø© A4 */
.main-table th,.main-table td{
  font-size:.72rem;
}
.main-table th:nth-child(1),
.main-table td:nth-child(1){width:4%;}
.main-table th:nth-child(2),
.main-table td:nth-child(2){width:27%;}
.main-table th:nth-child(3),
.main-table td:nth-child(3){width:16%;}
.main-table th:nth-child(4),
.main-table td:nth-child(4){width:10%;}
.main-table th:nth-child(5),
.main-table td:nth-child(5){width:10%;}
.main-table th:nth-child(6),
.main-table td:nth-child(6){width:10%;}
.main-table th:nth-child(7),
.main-table td:nth-child(7){width:23%;}

/* ÙÙˆØªØ± */
footer{
  padding:6px 12px 10px;
  text-align:center;
  font-size:.78rem;
  color:var(--muted);
  border-top:1px solid var(--line);
  background:#fbfdfd;
}

/* Ø´Ø±ÙŠØ· Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… */
#statusBar{
  position:fixed;
  bottom:16px;
  right:16px;
  background:#ffffffee;
  padding:5px 11px;
  border-radius:999px;
  box-shadow:0 6px 16px rgba(0,0,0,.18);
  font-size:.8rem;
  color:var(--muted);
  display:flex;
  align-items:center;
  gap:7px;
}
.spinner{
  width:15px;
  height:15px;
  border-radius:50%;
  border:2px solid rgba(11,126,136,.25);
  border-top-color:#0b7e88;
  animation:spin .7s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg);}}

/* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,.7);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:40;
  padding:8px;
}
.modal-backdrop.active{display:flex;}
.modal-inner{
  max-width:900px;
  width:100%;
  max-height:96vh;
  overflow:auto;
  border-radius:18px;
  background:#f3f5f6;
  box-shadow:0 18px 40px rgba(0,0,0,.35);
  position:relative;
}
.modal-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:8px 14px;
  border-bottom:1px solid #dde5e8;
}
.modal-header h2{
  margin:0;
  font-size:.96rem;
  font-weight:800;
  color:#064b50;
}
.modal-actions-top{
  display:flex;
  gap:8px;
}
.modal-actions-top .btn{
  padding:4px 9px;
  font-size:.78rem;
}
.modal-body{
  padding:10px 16px 16px;
}
.a4-page{
  background:#fff;
  border-radius:10px;
  box-shadow:0 0 0 1px #e3e7ea;
  padding:18px 18px 20px;
  color:#111827;
  font-size:.84rem;
}
.a4-page h3{
  margin:0 0 6px;
  font-size:.9rem;
  text-align:center;
}
.a4-page .meta{
  font-size:.8rem;
  margin-bottom:6px;
  text-align:center;
  color:#4b5563;
}
.a4-page table{
  font-size:.76rem;
  table-layout:fixed;
  width:100%;
}
.a4-page th,.a4-page td{
  padding:3px 4px;
  border-bottom:1px solid #e5e7eb;
}

/* Ø£Ø¹Ù…Ø¯Ø© Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù†ÙˆØ§ÙØ° */
.absents-table th:nth-child(1),
.absents-table td:nth-child(1){width:5%;}
.absents-table th:nth-child(2),
.absents-table td:nth-child(2){width:25%;}
.absents-table th:nth-child(3),
.absents-table td:nth-child(3){width:17%;}
.absents-table th:nth-child(4),
.absents-table td:nth-child(4){width:13%;}
.absents-table th:nth-child(5),
.absents-table td:nth-child(5){width:13%;}
.absents-table th:nth-child(6),
.absents-table td:nth-child(6){width:13%;}
.absents-table th:nth-child(7),
.absents-table td:nth-child(7){width:14%;}

.late-table th:nth-child(1),
.late-table td:nth-child(1){width:5%;}
.late-table th:nth-child(2),
.late-table td:nth-child(2){width:28%;}
.late-table th:nth-child(3),
.late-table td:nth-child(3){width:17%;}
.late-table th:nth-child(4),
.late-table td:nth-child(4){width:15%;}
.late-table th:nth-child(5),
.late-table td:nth-child(5){width:15%;}
.late-table th:nth-child(6),
.late-table td:nth-child(6){width:10%;}
.late-table th:nth-child(7),
.late-table td:nth-child(7){width:10%;}

.noout-table th:nth-child(1),
.noout-table td:nth-child(1){width:5%;}
.noout-table th:nth-child(2),
.noout-table td:nth-child(2){width:25%;}
.noout-table th:nth-child(3),
.noout-table td:nth-child(3){width:17%;}
.noout-table th:nth-child(4),
.noout-table td:nth-child(4){width:13%;}
.noout-table th:nth-child(5),
.noout-table td:nth-child(5){width:13%;}
.noout-table th:nth-child(6),
.noout-table td:nth-child(6){width:17%;}
.noout-table th:nth-child(7),
.noout-table td:nth-child(7){width:5%;}
.noout-table th:nth-child(8),
.noout-table td:nth-child(8){width:5%;}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø§Ù…Ø© */
.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:4px 9px;
  border-radius:999px;
  border:none;
  font-size:.78rem;
  cursor:pointer;
  font-family:"Tajawal",sans-serif;
}
.btn-close{background:#e5e7eb;color:#111827;}
.btn-print{background:#0b7e88;color:#fff;}
.btn-wa{background:#25d366;color:#fff;}
.btn-letter{background:#0b7e88;color:#fff;}

/* Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
@media print{
  body{
    padding:0;
    background:#fff;
  }
  #statusBar,
  .print-btn,
  .filter-btn,
  .import-btn,
  .date-chip,
  .header-controls,
  .info-bar span.system,
  .modal-actions-top,
  .btn-wa,
  .btn-letter { display:none !important; }

  .shell{
    max-width:none;
    border-radius:0;
    box-shadow:none;
    border:none;
  }
  header{
    border-radius:0;
  }
  .table-wrapper{
    border-radius:0;
  }
}
</style>
</head>
<body>

<div class="shell">
  <header>
    <div class="header-main">
      <h1>ØªØ­Ù„ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ù…Ù† Ù…Ù„ÙØ§Øª Ø­Ø¶ÙˆØ±ÙŠ â€“ Excel</h1>
      <p>Ù…Ù†ØµØ© Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù Ø¨Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ù†ØµØ© Â«Ø­Ø¶ÙˆØ±ÙŠÂ» Ø§Ù„Ø±Ø³Ù…ÙŠØ©.</p>
      <div class="badge-pill">
        â° Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ: 7:00 Øµ â€“ 2:00 Ù… (7 Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„ ÙØ¹Ù„ÙŠØ©)
      </div>
    </div>

    <div class="header-controls">
      <div class="top-row">
        <!-- Ø²Ø± Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
        <button id="printMainBtn" class="print-btn">
          ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„
        </button>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØºÙŠØ§Ø¨ / Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ† / Ø¹Ø¯Ù… Ø§Ù„Ø§Ù†ØµØ±Ø§Ù -->
        <button id="btnAbsents" class="filter-btn">
          Ø§Ù„ØºÙŠØ§Ø¨ <span id="absentsCount" class="count">0</span>
        </button>
        <button id="btnLate" class="filter-btn">
          Ø§Ù„Ù…ØªØ£Ø®Ø±ÙˆÙ† <span id="lateCount" class="count">0</span>
        </button>
        <button id="btnNoOut" class="filter-btn">
          Ø¹Ø¯Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù / Ø¨Ø¹Ø¯ 2Ù… <span id="noOutCount" class="count">0</span>
        </button>

        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® -->
        <div class="date-chip">
          <span>Ø§Ù„ÙŠÙˆÙ…/Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</span>
          <input id="reportDate" type="date">
        </div>

        <!-- Ø²Ø± Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ -->
        <label class="import-btn">
          <span class="icon">ğŸ“</span>
          <span>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„ÙØ§Øª Ø­Ø¶ÙˆØ± Excel Ù…Ù† Ø­Ø¶ÙˆØ±ÙŠ</span>
          <input id="excelInput" type="file" accept=".xlsx,.xls,.csv" multiple>
        </label>
      </div>
    </div>
  </header>

  <main class="main">
    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
    <div class="official-header">
      <div class="official-lines">
        <p>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… â€“ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</p>
        <p>Ù‚Ø·Ø§Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ø§Ù„Ø®Ø¨Ø±</p>
        <p>Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ÙŠØ¹Ù‚ÙˆØ¨ÙŠ</p>
      </div>
      <div class="official-side">
        <p id="officialDateLine">Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®: Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø¨Ø¹Ø¯.</p>
        <p class="official-note">
          Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø±Ø¬Ø© Ù…Ù† ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ù†ØµØ© Â«Ø­Ø¶ÙˆØ±ÙŠÂ» Ø§Ù„Ø±Ø³Ù…ÙŠØ©Ø› Ø¨Ù‡Ø¯Ù Ø§Ù„ØªÙŠØ³ÙŠØ± ÙˆØ­ÙØ¸ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù.
        </p>
      </div>
    </div>

    <div class="info-bar">
      <span class="label" id="dateInfoLabel">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø¹Ø¯.</span>
      <span class="system" id="filesInfo">Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯.</span>
    </div>

    <div class="table-wrapper" id="recordsTableWrapper">
      <div class="empty-msg">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø«Ù… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù Ø£Ùˆ Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ù„ÙØ§Øª Excel Ø§Ù„ØµØ§Ø¯Ø±Ø© Ù…Ù† Ù…Ù†ØµØ© Ø­Ø¶ÙˆØ±ÙŠ.</div>
    </div>
  </main>

  <footer>
    Â© ØªÙ†ÙÙŠØ°: ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ â€” Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªÙ…Ø¯Ø© Ù…Ù† ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ù†ØµØ© Ø­Ø¶ÙˆØ±ÙŠ Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©.
  </footer>
</div>

<div id="statusBar">
  <span id="statusSpinner" style="display:none" class="spinner"></span>
  <span id="statusText">Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯.</span>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØºÙŠØ§Ø¨ -->
<div class="modal-backdrop" id="modalAbsents">
  <div class="modal-inner">
    <div class="modal-header">
      <h2>Ø³Ø¬Ù„ Ø§Ù„ØºÙŠØ§Ø¨ Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯</h2>
      <div class="modal-actions-top">
        <button class="btn btn-print" data-print-modal="modalAbsents">Ø·Ø¨Ø§Ø¹Ø©</button>
        <button class="btn btn-close" data-close-modal="modalAbsents">Ø¥ØºÙ„Ø§Ù‚ âœ–</button>
      </div>
    </div>
    <div class="modal-body">
      <div class="a4-page">
        <h3>ÙƒØ´Ù Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ†</h3>
        <div class="meta" id="absentsMeta"></div>
        <table id="absentsTable" class="absents-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</th>
              <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
              <th>Ø§Ù„ØªØ®ØµØµ</th>
              <th>Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</th>
              <th>ÙˆØ§ØªØ³Ø§Ø¨</th>
              <th>Ù…Ø³Ø§Ø¡Ù„Ø©</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ† -->
<div class="modal-backdrop" id="modalLate">
  <div class="modal-inner">
    <div class="modal-header">
      <h2>Ø³Ø¬Ù„ Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ† Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯</h2>
      <div class="modal-actions-top">
        <button class="btn btn-print" data-print-modal="modalLate">Ø·Ø¨Ø§Ø¹Ø©</button>
        <button class="btn btn-close" data-close-modal="modalLate">Ø¥ØºÙ„Ø§Ù‚ âœ–</button>
      </div>
    </div>
    <div class="modal-body">
      <div class="a4-page">
        <h3>ÙƒØ´Ù Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ† Ø¹Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù…</h3>
        <div class="meta" id="lateMeta"></div>
        <table id="lateTable" class="late-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</th>
              <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
              <th>ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±</th>
              <th>Ù…Ù‚Ø¯Ø§Ø± Ø§Ù„ØªØ£Ø®Ø±</th>
              <th>ÙˆØ§ØªØ³Ø§Ø¨</th>
              <th>Ù…Ø³Ø§Ø¡Ù„Ø©</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø¹Ø¯Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù / Ø¨Ø¹Ø¯ 2Ù… -->
<div class="modal-backdrop" id="modalNoOut">
  <div class="modal-inner">
    <div class="modal-header">
      <h2>Ø¹Ø¯Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù / Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø¨Ø¹Ø¯ 2:00 Ù…</h2>
      <div class="modal-actions-top">
        <button class="btn btn-print" data-print-modal="modalNoOut">Ø·Ø¨Ø§Ø¹Ø©</button>
        <button class="btn btn-close" data-close-modal="modalNoOut">Ø¥ØºÙ„Ø§Ù‚ âœ–</button>
      </div>
    </div>
    <div class="modal-body">
      <div class="a4-page">
        <h3>ÙƒØ´Ù Ù…Ù† Ù„Ù… ÙŠØ³Ø¬Ù‘Ù„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø£Ùˆ Ø³Ø¬Ù‘Ù„ Ø¨Ø¹Ø¯ 2:00 Ù…</h3>
        <div class="meta" id="noOutMeta"></div>
        <table id="noOutTable" class="noout-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</th>
              <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
              <th>ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±</th>
              <th>ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</th>
              <th>ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th>ÙˆØ§ØªØ³Ø§Ø¨</th>
              <th>Ù…Ø³Ø§Ø¡Ù„Ø©</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø³Ø§Ø¡Ù„Ø© Ø§Ù„ÙØ±Ø¯ÙŠØ© -->
<div class="modal-backdrop" id="modalLetter">
  <div class="modal-inner">
    <div class="modal-header">
      <h2>Ù†Ù…ÙˆØ°Ø¬ Ù…Ø³Ø§Ø¡Ù„Ø© / ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù† Ø§Ù„Ø¯ÙˆØ§Ù…</h2>
      <div class="modal-actions-top">
        <button class="btn btn-print" data-print-modal="modalLetter">Ø·Ø¨Ø§Ø¹Ø©</button>
        <button class="btn btn-close" data-close-modal="modalLetter">Ø¥ØºÙ„Ø§Ù‚ âœ–</button>
      </div>
    </div>
    <div class="modal-body">
      <div class="a4-page">
        <div style="text-align:center;margin-bottom:6px;">
          <p style="margin:1px 0;font-size:.8rem;">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… â€“ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</p>
          <p style="margin:1px 0;font-size:.8rem;">Ù‚Ø·Ø§Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ø§Ù„Ø®Ø¨Ø± â€“ Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ÙŠØ¹Ù‚ÙˆØ¨ÙŠ</p>
          <h3 id="ltTitle" style="margin:4px 0 3px;">Ù…Ø³Ø§Ø¡Ù„Ø© Ø¹Ù† Ø§Ù„ØºÙŠØ§Ø¨ / Ø§Ù„ØªØ£Ø®Ø± / Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</h3>
        </div>
        <table style="width:100%;border-collapse:collapse;font-size:.8rem;margin-bottom:8px;">
          <tr><th style="text-align:right;width:150px;">Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…:</th><td id="ltName"></td></tr>
          <tr><th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©:</th><td id="ltId"></td></tr>
          <tr><th>Ø§Ù„ØªØ®ØµØµ:</th><td id="ltSubject"></td></tr>
          <tr><th>Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ:</th><td id="ltRole"></td></tr>
          <tr><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… Ù…Ø­Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:</th><td id="ltDate"></td></tr>
          <tr><th>ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±:</th><td id="ltAttend"></td></tr>
          <tr><th>ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù:</th><td id="ltLeave"></td></tr>
          <tr><th>ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®ØªØµØ±:</th><td id="ltStatus"></td></tr>
        </table>
        <p>Ø§Ù„Ù…ÙƒØ±Ù…/Ø© Ø§Ù„Ø£Ø³ØªØ§Ø°/Ø© <strong id="ltNameInline"></strong> Ø­ÙØ¸Ù‡ Ø§Ù„Ù„Ù‡</p>
        <p><strong>Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ØŒ ÙˆØ¨Ø¹Ø¯ ØŒØŒØŒ</strong></p>
        <p id="ltP1"></p>
        <p id="ltP2"></p>
        <p id="ltP3"></p>
        <br>
        <p>Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</p>
        <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ____________________________</p>
        <p>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù… Ø¨Ø§Ù„Ø§Ø·Ù„Ø§Ø¹: ____________________________</p>
      </div>
    </div>
  </div>
</div>

<script>
// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯ÙˆØ§Ù…
const DUTY_START = "07:00";
const DUTY_END   = "14:00";
const REQUIRED_MINUTES = 7*60;

// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
const teachersData = [
  {name:"Ù…ÙˆØ³Ù‰ ØµÙ„Ø¨Ø§Ù† Ø¹Ø¨Ø¯Ù‡ Ø¹Ø³ÙŠØ±ÙŠ",id:"1093013116",phone:"966507058931",subject:"ÙÙŠØ²ÙŠØ§",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ù…Ø¨Ø§Ø±Ùƒ Ø¹ÙˆØ¶Ù‡ Ø³ÙØ± Ø¢Ù„ Ø«Ø§Ø¨Øª",id:"1056464405",phone:"966597233399",subject:"ÙƒÙŠÙ…ÙŠØ§",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"ÙŠÙˆØ³Ù  Ø¹ÙŠØ³Ù‰ Ø§Ù„Ø¹ÙŠØ¯",id:"1012646822",phone:"966592038351",subject:"Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø­Ø³Ù† Ø¨Ù† ÙŠÙˆØ³Ù Ø¨Ù† Ø­Ø³ÙŠÙ† Ø§Ù„Ø®Ù„ÙŠÙÙ‡",id:"1056994203",phone:"966506907431",subject:"Ø§Ø­ÙŠØ§Ø¡",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ù…Ù†Ø°Ø± Ø¹Ø§Ù…Ø± Ø­Ù…ÙˆØ¯ Ø²Ù…ÙŠØ¹",id:"1065913053",phone:"966541188974",subject:"Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¹Ù…Ø§Ø¯ Ù…Ø­Ù…Ø¯ Ø¬Ù…Ø¹Ø§Ù† Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ",id:"1048667289",phone:"966542203039",subject:"Ù…ÙƒØªØ¨Ø§Øª",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø³Ø§Ù„Ù…ÙŠ",id:"1073861831",phone:"966558151033",subject:"ÙƒÙŠÙ…ÙŠØ§Ø¡",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø­Ø³Ù† Ø¹Ù„ÙŠ Ø­Ø³Ù† Ø§Ù„Ø´Ù‡Ø±ÙŠ",id:"1037273594",phone:"966536824355",subject:"Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø­Ø³ÙŠÙ† Ø¨Ù† Ø³Ø¹ÙŠØ¯ Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ù…Ø¯Ù†",id:"1022616799",phone:"966556336875",subject:"Ù…ÙƒØªØ¨Ø§Øª",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"ÙŠØ­ÙŠÙ‰ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",id:"1048978892",phone:"966555751385",subject:"Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"ÙØ±Ø¬ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ù„ÙŠ ÙŠÙˆØ³Ù Ø§Ù„ Ø³ÙŠÙ",id:"1000397735",phone:"966504113707",subject:"Ø±ÙŠØ§Ø¶ÙŠØ§Øª",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¨Ù†Ø¯Ø± Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ù…Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ",id:"1046853881",phone:"966546135135",subject:"Ø­Ø§Ø³Ø¨",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø­Ø³ÙŠÙ† Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† ÙÙ‡Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",id:"1014268567",phone:"966504988086",subject:"Ø§Ø­ÙŠØ§Ø¡",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ù†Ø§ØµØ± Ø¹Ù„ÙŠ Ù†Ø§ØµØ± Ø§Ù„Ø±Ø§Ø´Ø¯",id:"1008303370",phone:"966542933888",subject:"Ø­Ø§Ø³Ø¨",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø­Ø³ÙŠÙ† Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø­Ø³ÙŠÙ† Ø§Ù„Ø£Ø­Ù…Ø¯",id:"1060369202",phone:"966563740777",subject:"Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¹Ù„ÙŠ Ø³Ø¹Ø¯ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø§ØµÙ„Ø¹ÙŠ Ø§Ù„Ø§Ø­Ù…Ø±ÙŠ",id:"1023999780",phone:"966590986464",subject:"Ø§Ø­ÙŠØ§Ø¡",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø­Ø³Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠ Ø§Ù„Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡",id:"1005472780",phone:"966543705512",subject:"Ø§Ø­ÙŠØ§Ø¡",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ù…Ø­Ù…Ø¯ Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„ØªÙˆÙŠØ¬Ø±ÙŠ",id:"1064745944",phone:"966541381105",subject:"Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ÙÙŠØµÙ„ Ø¨Ù† ÙØ·ÙŠØ³ Ø§Ù„Ù‡Ø°Ù„ÙŠ",id:"1094733290",phone:"966591585407",subject:"Ø±ÙŠØ§Ø¶ÙŠØ§Øª",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­ÙŠÙ… Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ø¨ÙˆØ¹ØµÙŠØ¯Ù‡",id:"1033584234",phone:"966546623431",subject:"Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø¨Ù† Ø³ÙŠÙ Ø§Ù„Ø³Ù‡Ù„ÙŠ",id:"1063175010",phone:"966546221133",subject:"Ø¹Ù„Ù… Ø§Ø¬ØªÙ…Ø§Ø¹",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¨Ø´ÙŠØ± Ø¨Ù† Ø£Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¢Ù„ Ø³Ù„ÙŠÙ…",id:"1019783917",phone:"966500126925",subject:"Ù…ÙƒØªØ¨Ø§Øª",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø§Ù„Ø±Ø¨ÙŠØ¹",id:"1004182687",phone:"966548638056",subject:"Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø§Ù„Ù… Ø¢Ù„ Ø­Ø¨Ø´Ø§Ù†",id:"1004581359",phone:"966500223640",subject:"Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø®Ø§Ù„Ø¯ Ø³Ø¹Ø¯ Ø±Ø§Ø´Ø¯ Ø§Ù„Ù…Ø±Ø¶ÙŠ",id:"1025640010",phone:"966505877238",subject:"Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"ÙÙŠØµÙ„ ÙÙ‡Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ",id:"1086115373",phone:"966508448455",subject:"Ø±ÙŠØ§Ø¶ÙŠØ§Øª",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø­Ø¨ÙŠØ¨ Ø¹Ø¨Ø¯Ø§Ù„ØºÙ†ÙŠ Ø§Ù„Ù…ÙŠÙ…Ù†ÙŠ",id:"1072815481",phone:"966530163027",subject:"Ø±ÙŠØ§Ø¶ÙŠØ§Øª",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø²ÙŠØ§Ø¯ Ø¹ÙˆØ§Ø¶ Ø§Ø¨Ù† Ø¹ÙŠØ¶Ù‡ Ø§Ù„Ø¹Ù…Ø±ÙŠ",id:"1092156742",phone:"966557530102",subject:"Ø¹Ù„Ù… Ø¥Ø¯Ø§Ø±Ø©",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø¹Ø¨Ø¯Ø§Ù„Ø¬Ø¨Ø§Ø± Ø­Ù…ÙˆØ¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ",id:"1089635724",phone:"966555741488",subject:"ÙÙŠØ²ÙŠØ§",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¬Ù…ÙŠÙ„ Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø¬ÙˆØ§Ø¯ Ø§Ù„Ø¹Ù„ÙŠ",id:"1029281589",phone:"966566712113",subject:"ÙÙŠØ²ÙŠØ§",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø­Ø³Ù† Ø¹Ù…Ø± Ø§Ù„Ø§Ø¯Ø±ÙŠØ³ÙŠ",id:"1081556910",phone:"966533025505",subject:"Ø±ÙŠØ§Ø¶ÙŠØ§Øª",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"ØªÙ‚ÙŠ Ø¹Ø¨Ø¯ Ø§Ù„Ù‡Ø§Ø¯ÙŠ ØªÙ‚ÙŠ Ø§Ù„Ø¹Ù„ÙŠ",id:"1026472363",phone:"966543219321",subject:"ÙƒÙŠÙ…ÙŠØ§",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø®Ø§Ù„Ø¯ Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ",id:"1034318301",phone:"966560687900",subject:"ÙƒÙŠÙ…ÙŠØ§",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"ØµØ§Ù„Ø­ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¨Ù† ØµØ§Ù„Ø­ Ø§Ù„Ø³Ù…ÙŠØ­ÙŠ",id:"1003535422",phone:"966506921115",subject:"Ø¯ÙŠÙ†",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡  Ø®Ù„ÙˆÙØ©  Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„ Ù…Ø±Ø¹ÙŠ",id:"1029490875",phone:"966533225515",subject:"Ø¯ÙŠÙ†",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¨Ù† Ø£Ø­Ù…Ø¯ Ø¨Ù† Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø§Ù„Ø¹Ø¬Ù„Ø§Ù†",id:"1001082179",phone:"966559999808",subject:"Ø¯ÙŠÙ†",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¹Ø§Ø¯Ù„ Ø¨Ù† Ø¹Ù„ÙŠ Ø¨Ù† Ù†Ø§ØµØ± Ø§Ù„Ø¨Ø§Ø±Ù‚ÙŠ",id:"1007370701",phone:"966530667666",subject:"Ø±ÙŠØ§Ø¶Ù‡",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ù†Ø¨ÙŠÙ„ Ø¨Ù† Ù…Ø­Ø³Ù† Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ù‚Ù„Ø§Ù",id:"1025472604",phone:"966562962766",subject:"Ø±ÙŠØ§Ø¶Ù‡",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"Ø¹Ø§Ø¯Ù„ Ø¨Ù† Ø¹Ù„ÙŠ Ø¨Ù† Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø³Ø¨Ø¹Ø§Ù†",id:"1005472780",phone:"966504836200",subject:"Ù…ÙˆØ¬Ù‡ Ø·Ù„Ø§Ø¨ÙŠ",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"ÙŠØ§Ø³Ø± Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø§Ù„Ù†Ù…Ø±",id:"1001443397",phone:"966503834833",subject:"Ù…Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª",role:"Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¹Ù„Ù…"},
  {name:"Ø¹Ù„ÙŠ Ø¨Ù† Ø­Ø³Ù† Ø¨Ù† Ø¹Ù„ÙŠ Ø¢Ù„ Ù‚Ù…Ø¨Ø±",id:"1004780860",phone:"966502085389",subject:"Ø³ÙƒØ±ØªØ§Ø±ÙŠÙ‡",role:"Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¹Ù„Ù…"},
  {name:"Ø­Ø³Ù† Ø¨Ù† Ø¹Ø§Ù…Ø± Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ",id:"1013124175",phone:"966598893731",subject:"Ù…Ø­Ø¶Ø± Ù…Ø®ØªØ¨Ø±",role:"Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¹Ù„Ù…"},
  {name:"Ø¹Ø¯Ù†Ø§Ù† Ø¹Ù„ÙŠ Ø­Ø³ÙŠÙ† Ø§Ù„Ø²Ø±ÙŠÙ‚",id:"1015776766",phone:"966505808451",subject:"ÙˆÙƒÙŠÙ„",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"},
  {name:"ÙÙ‡Ø¯ Ø­Ø§Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ",id:"1024193532",phone:"966504532489",subject:"Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©",role:"Ù…Ø¹Ù„Ù… Ù…Ù…Ø§Ø±Ø³"}
];

const teacherById = {};
teachersData.forEach(t=>teacherById[t.id]=t);

// Ø¹Ù†Ø§ØµØ± DOM
const excelInput = document.getElementById('excelInput');
const recordsTableWrapper = document.getElementById('recordsTableWrapper');
const statusText = document.getElementById('statusText');
const statusSpinner = document.getElementById('statusSpinner');
const filesInfo = document.getElementById('filesInfo');
const dateInfoLabel = document.getElementById('dateInfoLabel');
const reportDateInput = document.getElementById('reportDate');
const printMainBtn = document.getElementById('printMainBtn');
const officialDateLine = document.getElementById('officialDateLine');

const absentsCount = document.getElementById('absentsCount');
const lateCount = document.getElementById('lateCount');
const noOutCount = document.getElementById('noOutCount');

const modalAbsents = document.getElementById('modalAbsents');
const modalLate = document.getElementById('modalLate');
const modalNoOut = document.getElementById('modalNoOut');
const modalLetter = document.getElementById('modalLetter');

// Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø³Ø§Ø¡Ù„Ø©
const ltName = document.getElementById('ltName');
const ltId = document.getElementById('ltId');
const ltSubject = document.getElementById('ltSubject');
const ltRole = document.getElementById('ltRole');
const ltDate = document.getElementById('ltDate');
const ltAttend = document.getElementById('ltAttend');
const ltLeave = document.getElementById('ltLeave');
const ltStatus = document.getElementById('ltStatus');
const ltNameInline = document.getElementById('ltNameInline');
const ltTitle = document.getElementById('ltTitle');
const ltP1 = document.getElementById('ltP1');
const ltP2 = document.getElementById('ltP2');
const ltP3 = document.getElementById('ltP3');

// Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù†ÙˆØ§ÙØ°
const absentsMeta = document.getElementById('absentsMeta');
const lateMeta = document.getElementById('lateMeta');
const noOutMeta = document.getElementById('noOutMeta');
const absentsTableBody = document.querySelector('#absentsTable tbody');
const lateTableBody = document.querySelector('#lateTable tbody');
const noOutTableBody = document.querySelector('#noOutTable tbody');

let allLogs = [];
let dailyRecords = [];

// Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠØ©
let currentWeekday = '';
let currentGreg = '';
let currentHijri = '';

// Ø£Ø­Ø¯Ø§Ø«
excelInput.addEventListener('change', handleFiles);
reportDateInput.addEventListener('change', rebuildDaily);
printMainBtn.addEventListener('click', ()=>window.print());

document.getElementById('btnAbsents').addEventListener('click', ()=>openModal('modalAbsents'));
document.getElementById('btnLate').addEventListener('click', ()=>openModal('modalLate'));
document.getElementById('btnNoOut').addEventListener('click', ()=>openModal('modalNoOut'));

document.querySelectorAll('[data-close-modal]').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const id = btn.getAttribute('data-close-modal');
    document.getElementById(id).classList.remove('active');
  });
});
document.querySelectorAll('[data-print-modal]').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const id = btn.getAttribute('data-print-modal');
    const modal = document.getElementById(id);
    if(!modal) return;
    const backup = document.body.innerHTML;
    document.body.innerHTML = modal.outerHTML;
    window.print();
    document.body.innerHTML = backup;
    location.reload();
  });
});

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„ÙŠÙˆÙ…
(function initDateToday(){
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth()+1).padStart(2,'0');
  const dd = String(today.getDate()).padStart(2,'0');
  reportDateInput.value = `${yyyy}-${mm}-${dd}`;
  updateDateLabel();
})();

// Ù†Øµ ÙˆØµÙ Ø§Ù„ØªØ§Ø±ÙŠØ®
function updateDateLabel(){
  const val = reportDateInput.value;
  if(!val){
    dateInfoLabel.textContent = "Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø¹Ø¯.";
    officialDateLine.textContent = "Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®: Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø¨Ø¹Ø¯.";
    currentWeekday = currentGreg = currentHijri = '';
    return;
  }
  const d = new Date(val + "T00:00:00");
  if(isNaN(d.getTime())){
    dateInfoLabel.textContent = "ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ§Ù„Ø­.";
    officialDateLine.textContent = "Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®: ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ§Ù„Ø­.";
    currentWeekday = currentGreg = currentHijri = '';
    return;
  }
  currentWeekday = d.toLocaleDateString('ar-SA',{weekday:'long'});
  currentGreg = d.toLocaleDateString('ar-SA',{year:'numeric',month:'2-digit',day:'2-digit'});
  currentHijri = d.toLocaleDateString('ar-SA-u-ca-islamic-umalqura',{year:'numeric',month:'2-digit',day:'2-digit'});
  dateInfoLabel.textContent = `Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯: ${currentWeekday} ${currentGreg} Ù… Ø§Ù„Ù…ÙˆØ§ÙÙ‚ ${currentHijri} Ù‡Ù€.`;
  officialDateLine.textContent = `Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®: ${currentWeekday} ${currentGreg} Ù… / ${currentHijri} Ù‡Ù€.`;
}

function getDateLabel(){
  if(!currentWeekday || !currentGreg || !currentHijri) return '';
  return `ÙŠÙˆÙ… (${currentWeekday}) Ø§Ù„Ù…ÙˆØ§ÙÙ‚ (${currentGreg} Ù… / ${currentHijri} Ù‡Ù€)`;
}

// Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
function setStatus(msg, loading=false){
  statusText.textContent = msg;
  statusSpinner.style.display = loading ? 'inline-block' : 'none';
}

// ØªØ­ÙˆÙŠÙ„Ø§Øª
function normalizeDate(raw){
  if(raw===undefined || raw===null) return '';
  let s = String(raw).trim();
  if(!s) return '';
  if(!isNaN(Number(s)) && !s.includes('-') && !s.includes('/')){
    const n = Number(s);
    const base = new Date(1899,11,30);
    const d = new Date(base.getTime()+n*24*60*60*1000);
    const y=d.getFullYear();
    const m=String(d.getMonth()+1).padStart(2,'0');
    const day=String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }
  s = s.replace(/\./g,'/').replace(/\\/g,'/');
  let m = s.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})$/);
  if(m){
    const y=m[1], mm=String(m[2]).padStart(2,'0'), dd=String(m[3]).padStart(2,'0');
    return `${y}-${mm}-${dd}`;
  }
  m = s.match(/^(\d{2})-(\d{2})-(\d{2})$/);
  if(m){
    const yy=parseInt(m[1],10);
    const year=yy>=80?1900+yy:2000+yy;
    return `${year}-${m[2]}-${m[3]}`;
  }
  return '';
}
function normalizeTime(raw){
  if(raw===undefined || raw===null) return '';
  let s = String(raw).trim();
  if(!s) return '';
  if(!isNaN(Number(s)) && !s.includes(':')){
    const val = Number(s);
    if(val>=0 && val<1){
      const totalMin=Math.round(val*24*60);
      const h=String(Math.floor(totalMin/60)).padStart(2,'0');
      const m=String(totalMin%60).padStart(2,'0');
      return `${h}:${m}`;
    }
  }
  s = s.replace(/\s+/g,'').toUpperCase();
  let m = s.match(/^(\d{1,2}):(\d{2})(AM|PM)?$/);
  if(m){
    let h=parseInt(m[1],10);
    const mm=m[2];
    const ampm=m[3];
    if(ampm==='PM' && h<12) h+=12;
    if(ampm==='AM' && h===12) h=0;
    return `${String(h).padStart(2,'0')}:${mm}`;
  }
  m = s.match(/^(\d{1,2}):(\d{2})$/);
  if(m){
    const h=String(parseInt(m[1],10)).padStart(2,'0');
    const mm=m[2];
    return `${h}:${mm}`;
  }
  return '';
}
function toMinutes(hhmm){
  if(!hhmm) return 0;
  const p = hhmm.split(':').map(Number);
  if(p.length!==2 || p.some(isNaN)) return 0;
  return p[0]*60+p[1];
}
function minutesToHHMM(mins){
  const m = Math.max(0,Math.round(mins));
  const h = Math.floor(m/60);
  const mm = m%60;
  return `${String(h).padStart(2,'0')}:${String(mm).padStart(2,'0')}`;
}
function diffTimes(start,end){
  if(!start || !end) return 0;
  let s = toMinutes(start), e=toMinutes(end);
  if(s===0 && e===0) return 0;
  let d = e-s;
  if(d<0) d+=24*60;
  return d;
}
function guessDateFromFileName(name){
  const m = name.match(/(\d{4})[^\d]?(\d{1,2})[^\d]?(\d{1,2})/);
  if(!m) return '';
  const y=m[1];
  const mm=String(m[2]).padStart(2,'0');
  const dd=String(m[3]).padStart(2,'0');
  return `${y}-${mm}-${dd}`;
}

// Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
async function handleFiles(e){
  const files = Array.from(e.target.files||[]);
  if(!files.length) return;

  const selectedDate = reportDateInput.value || '';
  if(!selectedDate){
    alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…/Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø£ÙˆÙ„Ù‹Ø§ Ù‚Ø¨Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„ÙØ§Øª Ø§Ù„Ø­Ø¶ÙˆØ±.");
    return;
  }

  const hadUserDate = !!selectedDate;

  setStatus('Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„ÙØ§Øª Excel ÙˆØªØ­Ù„ÙŠÙ„Ù‡Ø§ ...',true);
  filesInfo.textContent = `${files.length} Ù…Ù„Ù/Ù…Ù„ÙØ§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ...`;
  allLogs = [];
  dailyRecords = [];
  recordsTableWrapper.innerHTML = '<div class="empty-msg">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ...</div>';

  for(const file of files){
    try{
      await readExcelFile(file, selectedDate);
    }catch(err){
      console.error(err);
    }
  }

  if(!allLogs.length){
    setStatus('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø¬Ù„Ø§Øª Ø­Ø¶ÙˆØ± Ø¨Ø¹Ø¯ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙØ§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† ØµÙ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† (Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸ÙØŒ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠØŒ ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø­Ø¶ÙˆØ±ØŒ ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø§Ù†ØµØ±Ø§ÙØŒ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª) Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ±.',false);
    filesInfo.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø¬Ù„Ø§Øª Ø­Ø¶ÙˆØ± ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©.';
    recordsTableWrapper.innerHTML = '<div class="empty-msg">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø¬Ù„Ø§Øª Ø­Ø¶ÙˆØ± Ø¨Ø¹Ø¯ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙØ§Øª.</div>';
    return;
  }

  // Ø§Ø³ØªÙ†ØªØ§Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø³ØªÙƒÙˆÙ† ÙƒÙ„Ù‡Ø§ Ø¨ØªØ§Ø±ÙŠØ® selectedDate ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙØ¹Ø©)
  const dates = Array.from(new Set(allLogs.map(l=>l.date).filter(Boolean))).sort();
  const maxDate = dates[dates.length-1];

  // Ø¥Ù† Ù„Ù… ÙŠØ­Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªØ§Ø±ÙŠØ®Ù‹Ø§ Ù…Ø³Ø¨Ù‚Ù‹Ø§ (Ø­Ø§Ù„Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©)ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø£Ø­Ø¯Ø« ØªØ§Ø±ÙŠØ®
  if(!hadUserDate && maxDate){
    reportDateInput.value = maxDate;
  }

  updateDateLabel();

  setStatus(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${allLogs.length} Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ± Ù…Ù† ${files.length} Ù…Ù„Ù/Ù…Ù„ÙØ§Øª.`,false);
  filesInfo.textContent = `ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† ${files.length} Ù…Ù„ÙØŒ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø®Ø§Ù…: ${allLogs.length}.`;

  rebuildDaily();
}

function readExcelFile(file, forcedDate){
  return new Promise((resolve,reject)=>{
    const reader=new FileReader();
    reader.onload = evt=>{
      try{
        const data=evt.target.result;
        const wb=XLSX.read(data,{type:'array'});
        const fallbackDate = forcedDate || guessDateFromFileName(file.name);

        wb.SheetNames.forEach(sheetName=>{
          const sheet=wb.Sheets[sheetName];
          const rows=XLSX.utils.sheet_to_json(sheet,{header:1,defval:''});
          if(!rows.length) return;

          let headerRowIndex = rows.findIndex(r=>{
            const joined = r.map(c=>String(c)).join(' ');
            return /Ø§Ø³Ù…\s*Ø§Ù„Ù…ÙˆØ¸Ù/.test(joined) && /Ø§Ù„Ø±Ù‚Ù…\s*Ø§Ù„ÙˆØ¸ÙŠÙÙŠ/.test(joined);
          });
          if(headerRowIndex<0) headerRowIndex = 0;

          const headers = rows[headerRowIndex].map(h=>String(h||'').trim());

          const idIdx     = headers.findIndex(h=>/Ù‡ÙˆÙŠØ©|Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ|Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù|Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù„Ù…|ID/i.test(h));
          const dateIdx   = headers.findIndex(h=>/ØªØ§Ø±ÙŠØ®/i.test(h));
          const inIdx     = headers.findIndex(h=>/Ø§Ù„Ø­Ø¶ÙˆØ±|ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø­Ø¶ÙˆØ±|ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±/i.test(h));
          const outIdx    = headers.findIndex(h=>/Ø§Ù„Ø§Ù†ØµØ±Ø§Ù|ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù|ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù/i.test(h));
          const hoursIdx  = headers.findIndex(h=>/Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª|Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¯ÙˆØ§Ù…|Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„ÙØ¹Ù„ÙŠ/i.test(h));

          if(idIdx<0 || inIdx<0 || outIdx<0 || hoursIdx<0){
            return;
          }

          for(let r=headerRowIndex+1;r<rows.length;r++){
            const row = rows[r];
            const idRaw = idIdx>=0 ? row[idIdx] : '';
            const id = String(idRaw||'').replace(/[^\d]/g,'');
            if(!id) continue;

            // Ù‡Ù†Ø§ Ù†Ø¶Ø¨Ø· Ø§Ù„ØªØ§Ø±ÙŠØ®: Ø¥Ù† ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ forcedDate Ù†Ø³ØªØ®Ø¯Ù…Ù‡ØŒ ÙˆØ¥Ù„Ø§ Ù†Ù‚Ø±Ø£ Ù…Ù† Ø§Ù„Ù…Ù„Ù
            let dateStr='';
            if(forcedDate){
              dateStr = forcedDate;
            }else if(dateIdx>=0){
              dateStr = normalizeDate(row[dateIdx]);
            }
            if(!dateStr) dateStr = fallbackDate;

            const attend = normalizeTime(row[inIdx]);
            const leave  = normalizeTime(row[outIdx]);
            const hoursRaw = normalizeTime(row[hoursIdx]);

            let workMinutes = 0;
            if(hoursRaw){
              workMinutes = toMinutes(hoursRaw);
            }else if(attend && leave){
              workMinutes = diffTimes(attend,leave);
            }

            const dutyStartMin = toMinutes(DUTY_START);
            const dutyEndMin   = toMinutes(DUTY_END);
            let tardyMinutes = 0;
            if(attend){
              const attendMin = toMinutes(attend);
              tardyMinutes = Math.max(0,attendMin-dutyStartMin);
            }

            let absent = false;
            let missingCheckout = false;
            let afterTwo = false;
            let lackMinutes = 0;

            if(!attend && !leave && !workMinutes){
              absent = true;
            }else{
              if(!leave){
                missingCheckout = true;
              }else{
                const outMin = toMinutes(leave);
                if(outMin > dutyEndMin){
                  afterTwo = true;
                }
              }
              if(workMinutes < REQUIRED_MINUTES){
                lackMinutes = REQUIRED_MINUTES - workMinutes;
              }
            }

            let statusShort = 'Ø³Ù„ÙŠÙ…';
            if(absent){
              statusShort = 'ØºÙŠØ§Ø¨';
            }else if(missingCheckout){
              statusShort = 'Ù„Ù… ÙŠØ³Ø¬Ù„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù';
            }else if(afterTwo){
              statusShort = 'Ø§Ù†ØµØ±Ø§Ù Ø¨Ø¹Ø¯ 2:00Ù…';
            }else if(tardyMinutes>0){
              statusShort = 'ØªØ£Ø®Ø±';
            }else if(lackMinutes>0){
              statusShort = 'Ø¯ÙˆØ§Ù… Ø£Ù‚Ù„ Ù…Ù† 7 Ø³Ø§Ø¹Ø§Øª';
            }

            const teacher = teacherById[id] || {name:'ØºÙŠØ± Ù…Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©',subject:'',role:''};

            allLogs.push({
              file:file.name,
              sheet:sheetName,
              date:dateStr,
              id,
              teacherName:teacher.name,
              subject:teacher.subject,
              role:teacher.role,
              attend,
              leave,
              workMinutes,
              workHHMM:minutesToHHMM(workMinutes),
              tardyMinutes,
              lackMinutes,
              absent,
              missingCheckout,
              afterTwo,
              statusShort
            });
          }
        });
        resolve();
      }catch(err){
        reject(err);
      }
    };
    reader.onerror = reject;
    reader.readAsArrayBuffer(file);
  });
}

// Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯
function rebuildDaily(){
  updateDateLabel();
  const targetDate = reportDateInput.value || '';

  if(!allLogs.length){
    recordsTableWrapper.innerHTML = '<div class="empty-msg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø­Ø¶ÙˆØ± Ø¨Ø¹Ø¯.</div>';
    absentsCount.textContent = '0';
    lateCount.textContent = '0';
    noOutCount.textContent = '0';
    return;
  }

  const logsById = {};
  allLogs.forEach(log=>{
    if(targetDate && log.date && log.date!==targetDate) return;
    logsById[log.id] = log;
  });

  dailyRecords = [];

  teachersData.forEach(t=>{
    const log = logsById[t.id];
    if(log){
      dailyRecords.push(log);
    }else{
      dailyRecords.push({
        date:targetDate,
        id:t.id,
        teacherName:t.name,
        subject:t.subject,
        role:t.role,
        attend:'',
        leave:'',
        workMinutes:0,
        workHHMM:'00:00',
        tardyMinutes:0,
        lackMinutes:REQUIRED_MINUTES,
        absent:true,
        missingCheckout:false,
        afterTwo:false,
        statusShort:'ØºÙŠØ§Ø¨'
      });
    }
  });

  // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©: Ø§Ù„Ù…Ø¨ÙƒØ± ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ØŒ Ø«Ù… Ø§Ù„Ø¨Ù‚ÙŠØ©ØŒ Ø«Ù… Ø§Ù„ØºØ§Ø¦Ø¨ÙˆÙ† ÙÙŠ Ø¢Ø®Ø± Ø§Ù„ÙƒØ´Ù
  dailyRecords.sort((a,b)=>{
    const aAttend = a.attend ? toMinutes(a.attend) : 99999;
    const bAttend = b.attend ? toMinutes(b.attend) : 99999;
    if(a.absent && !b.absent) return 1;
    if(!a.absent && b.absent) return -1;
    if(aAttend === bAttend) return a.teacherName.localeCompare(b.teacherName,'ar');
    return aAttend - bAttend;
  });

  renderMainTable();
  buildModalTables();
}

// Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³
function renderMainTable(){
  if(!dailyRecords.length){
    recordsTableWrapper.innerHTML='<div class="empty-msg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯.</div>';
    return;
  }

  let rowsHtml = '';
  dailyRecords.forEach((rec,idx)=>{
    let badgeClass='badge badge-ok';
    if(rec.statusShort==='ØºÙŠØ§Ø¨' || rec.missingCheckout || rec.afterTwo) badgeClass='badge badge-danger';
    else if(rec.statusShort!=='Ø³Ù„ÙŠÙ…') badgeClass='badge badge-warn';

    rowsHtml += `
      <tr>
        <td>${idx+1}</td>
        <td>${rec.teacherName}</td>
        <td>${rec.id}</td>
        <td>${rec.attend || '--:--'}</td>
        <td>${rec.leave || '--:--'}</td>
        <td>${rec.workHHMM}</td>
        <td><span class="${badgeClass}">${rec.statusShort}</span></td>
      </tr>
    `;
  });

  recordsTableWrapper.innerHTML = `
    <table class="main-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</th>
          <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
          <th>ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±</th>
          <th>ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</th>
          <th>Ù…Ø¯Ø© Ø§Ù„Ø¯ÙˆØ§Ù…</th>
          <th>ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®ØªØµØ±</th>
        </tr>
      </thead>
      <tbody>${rowsHtml}</tbody>
    </table>
  `;
}

// Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„Ø© (ØºÙŠØ§Ø¨ / ØªØ£Ø®Ø± / Ø®Ø±ÙˆØ¬/Ø§Ù†ØµØ±Ø§Ù)
function getCaseType(rec){
  if(rec.absent) return 'ØºÙŠØ§Ø¨';
  if(rec.tardyMinutes>0) return 'ØªØ£Ø®Ø±';
  if(rec.missingCheckout || rec.afterTwo || rec.workMinutes<REQUIRED_MINUTES) return 'Ø§Ù†ØµØ±Ø§Ù';
  return 'Ø¹Ø§Ù…';
}

// ØµÙŠØ§ØºØ© Ù…Ø¯Ø© Ø§Ù„ØªØ£Ø®Ø± Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
function formatDelayAr(mins){
  const m = Math.round(mins);
  const h = Math.floor(m/60);
  const r = m%60;
  if(h>0 && r>0) return `${h} Ø³Ø§Ø¹Ø© Ùˆ ${r} Ø¯Ù‚ÙŠÙ‚Ø©`;
  if(h>0) return `${h} Ø³Ø§Ø¹Ø©`;
  return `${r} Ø¯Ù‚ÙŠÙ‚Ø©`;
}

// Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ ØªØ±Ø¨ÙˆÙŠØ© Ù„ÙƒÙ„ Ø­Ø§Ù„Ø©
function buildWhatsappMessage(rec){
  const datePhrase = getDateLabel() || `ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ± (${reportDateInput.value})`;
  const teacherName = rec.teacherName || 'Ø§Ù„Ù…Ø¹Ù„Ù…';

  const caseType = getCaseType(rec);
  let body = '';

  if(caseType === 'ØºÙŠØ§Ø¨'){
    body =
`Ù†Ø­ÙŠØ·ÙƒÙ… Ø¹Ù„Ù…Ù‹Ø§ Ø¨ØºÙŠØ§Ø¨ÙƒÙ… Ø¹Ù† Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ ${datePhrase} Ø¯ÙˆÙ† Ø¹Ø°Ø± Ù†Ø¸Ø§Ù…ÙŠØŒ ÙˆÙŠÙÙ„Ø²Ù… Ø§Ù„Ù…Ø¹Ù„Ù… Ø¨Ø±ÙØ¹ Ø§Ù„Ø¹Ø°Ø± Ø§Ù„Ø§Ø¶Ø·Ø±Ø§Ø±ÙŠ Ø£Ùˆ Ø§Ù„Ù…Ø±Ø¶ÙŠ Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… ÙØ§Ø±Ø³ Ø®Ù„Ø§Ù„ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŒ Ø¹Ù„Ù‰ Ø£Ù† ÙŠØªÙ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ØºÙŠØ§Ø¨ ÙÙŠ Ù…Ù†ØµØ© Ø­Ø¶ÙˆØ±ÙŠØŒ ÙˆØ³ÙŠÙØªØ§Ø¨ÙØ¹ Ø°Ù„Ùƒ Ù…Ù† Ù‚Ø¨Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ÙˆÙÙ‚ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©.`;
  }else if(caseType === 'ØªØ£Ø®Ø±'){
    const delayText = formatDelayAr(rec.tardyMinutes);
    body =
`Ù†Ø­ÙŠØ·ÙƒÙ… Ø¹Ù„Ù…Ù‹Ø§ Ø¨Ø£Ù†Ù‡ ØªÙ… Ø±ØµØ¯ ØªØ£Ø®Ø±ÙƒÙ… Ø¹Ù† Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ ${datePhrase}ØŒ Ø­ÙŠØ« ØªÙ… ØªØ³Ø¬ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø³Ø§Ø¹Ø© (${rec.attend || '--:--'})ØŒ ÙˆØ¨Ù…Ø¯Ø© ØªØ£Ø®ÙŠØ± Ù‚Ø¯Ø±Ù‡Ø§ (${delayText})ØŒ ÙˆÙ†Ø¤ÙƒØ¯ Ø¹Ù„Ù‰ Ø¶Ø±ÙˆØ±Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©ØŒ ÙˆØ³ÙŠÙØªØ§Ø¨ÙØ¹ Ø°Ù„Ùƒ ÙˆÙÙ‚ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©.`;
  }else if(caseType === 'Ø§Ù†ØµØ±Ø§Ù'){
    const extra = rec.afterTwo ? " Ø£Ùˆ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© (2:00 Ù…)" : "";
    body =
`Ù†Ø­ÙŠØ·ÙƒÙ… Ø¹Ù„Ù…Ù‹Ø§ Ø¨Ø£Ù†Ù‡ ØªÙ… Ø±ØµØ¯ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø¯ÙˆÙ† Ø§Ø³ØªØ¦Ø°Ø§Ù† Ù†Ø¸Ø§Ù…ÙŠ Ø£Ùˆ Ø¹Ø¯Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù ${datePhrase}ØŒ Ø­ÙŠØ« ØªÙ… ØªØ³Ø¬ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø³Ø§Ø¹Ø© (${rec.attend || '--:--'})ØŒ ÙˆØ¹Ø¯Ù… Ø¥ÙƒÙ…Ø§Ù„ Ù…Ø¯Ø© Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø¨Ù€ Ø³Ø¨Ø¹ Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„${extra}ØŒ ÙˆÙ†Ø¤ÙƒØ¯ Ø£Ù† Ø°Ù„Ùƒ ÙŠØ®Ø¶Ø¹ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ§ØªØ®Ø§Ø° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠ ÙˆÙÙ‚ ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ….`;
  }else{
    body =
`Ù†Ø­ÙŠØ·ÙƒÙ… Ø¹Ù„Ù…Ù‹Ø§ Ø¨ÙˆØ¬ÙˆØ¯ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ§Ù… ${datePhrase}ØŒ ÙˆÙ†Ø¤ÙƒØ¯ Ø¹Ù„Ù‰ Ø£Ù‡Ù…ÙŠØ© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©.`;
  }

  return `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ Ø£.${teacherName}ØŒ

${body}

Ø´Ø§ÙƒØ±ÙŠÙ† ØªØ¹Ø§ÙˆÙ†ÙƒÙ… ÙˆØ­Ø±ØµÙƒÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ù…Ù‡Ù†ÙŠ.`;
}

// Ø¨Ù†Ø§Ø¡ Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ØºÙŠØ§Ø¨/Ø§Ù„ØªØ£Ø®Ø±/Ø¹Ø¯Ù… Ø§Ù„Ø§Ù†ØµØ±Ø§Ù
function buildModalTables(){
  const absents = dailyRecords.filter(r=>getCaseType(r)==='ØºÙŠØ§Ø¨');
  const late = dailyRecords.filter(r=>getCaseType(r)==='ØªØ£Ø®Ø±');
  const noOut = dailyRecords.filter(r=>getCaseType(r)==='Ø§Ù†ØµØ±Ø§Ù');

  absentsCount.textContent = absents.length;
  lateCount.textContent = late.length;
  noOutCount.textContent = noOut.length;

  const dLabel = dateInfoLabel.textContent;
  absentsMeta.textContent = dLabel;
  lateMeta.textContent = dLabel;
  noOutMeta.textContent = dLabel;

  absentsTableBody.innerHTML = '';
  absents.forEach((r,i)=>{
    const t = teacherById[r.id] || {};
    const phone = t.phone || '';
    let waCell='-';
    if(/^966\d{9}$/.test(phone)){
      const msg = encodeURIComponent(buildWhatsappMessage(r));
      const url = `https://wa.me/${phone}?text=${msg}`;
      waCell = `<a href="${url}" target="_blank" class="btn btn-wa">ÙˆØ§ØªØ³Ø§Ø¨</a>`;
    }
    const letterBtn = `<button class="btn btn-letter" data-letter-id="${r.id}">Ù…Ø³Ø§Ø¡Ù„Ø©</button>`;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${r.teacherName}</td>
      <td>${r.id}</td>
      <td>${t.subject || r.subject || ''}</td>
      <td>${t.role || r.role || ''}</td>
      <td>${waCell}</td>
      <td>${letterBtn}</td>
    `;
    absentsTableBody.appendChild(tr);
  });

  lateTableBody.innerHTML = '';
  late.forEach((r,i)=>{
    const t = teacherById[r.id] || {};
    const phone = t.phone || '';
    let waCell='-';
    if(/^966\d{9}$/.test(phone)){
      const msg = encodeURIComponent(buildWhatsappMessage(r));
      const url = `https://wa.me/${phone}?text=${msg}`;
      waCell = `<a href="${url}" target="_blank" class="btn btn-wa">ÙˆØ§ØªØ³Ø§Ø¨</a>`;
    }
    const letterBtn = `<button class="btn btn-letter" data-letter-id="${r.id}">Ù…Ø³Ø§Ø¡Ù„Ø©</button>`;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${r.teacherName}</td>
      <td>${r.id}</td>
      <td>${r.attend || '--:--'}</td>
      <td>${r.tardyMinutes ? formatDelayAr(r.tardyMinutes) : '0 Ø¯Ù‚ÙŠÙ‚Ø©'}</td>
      <td>${waCell}</td>
      <td>${letterBtn}</td>
    `;
    lateTableBody.appendChild(tr);
  });

  noOutTableBody.innerHTML = '';
  noOut.forEach((r,i)=>{
    const t = teacherById[r.id] || {};
    const phone = t.phone || '';
    let waCell='-';
    if(/^966\d{9}$/.test(phone)){
      const msg = encodeURIComponent(buildWhatsappMessage(r));
      const url = `https://wa.me/${phone}?text=${msg}`;
      waCell = `<a href="${url}" target="_blank" class="btn btn-wa">ÙˆØ§ØªØ³Ø§Ø¨</a>`;
    }
    let desc = 'Ù…Ù„Ø§Ø­Ø¸Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù';
    if(r.missingCheckout) desc = 'Ø¹Ø¯Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù';
    else if(r.afterTwo) desc = 'Ø§Ù†ØµØ±Ø§Ù Ø¨Ø¹Ø¯ 2:00 Ù…';
    const letterBtn = `<button class="btn btn-letter" data-letter-id="${r.id}">Ù„ÙØª Ù†Ø¸Ø±</button>`;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${r.teacherName}</td>
      <td>${r.id}</td>
      <td>${r.attend || '--:--'}</td>
      <td>${r.leave || '--:--'}</td>
      <td>${desc}</td>
      <td>${waCell}</td>
      <td>${letterBtn}</td>
    `;
    noOutTableBody.appendChild(tr);
  });

  // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡Ù„Ø©
  document.querySelectorAll('[data-letter-id]').forEach(btn=>{
    btn.onclick = ()=>{
      const id = btn.getAttribute('data-letter-id');
      const rec = dailyRecords.find(x=>x.id===id);
      if(rec) openLetter(rec);
    };
  });
}

// ÙØªØ­ Ù†Ø§ÙØ°Ø©
function openModal(id){
  const el = document.getElementById(id);
  if(!el) return;
  el.classList.add('active');
}

// Ù†ØµÙˆØµ Ø§Ù„Ù…Ø³Ø§Ø¡Ù„Ø©/Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
function openLetter(rec){
  const t = teacherById[rec.id] || {};
  ltName.textContent = rec.teacherName;
  ltId.textContent = rec.id;
  ltSubject.textContent = t.subject || rec.subject || '';
  ltRole.textContent = t.role || rec.role || '';
  ltDate.textContent = getDateLabel() || `ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ± (${reportDateInput.value})`;
  ltAttend.textContent = rec.attend || '--:--';
  ltLeave.textContent = rec.leave || '--:--';
  ltStatus.textContent = rec.statusShort || '';
  ltNameInline.textContent = rec.teacherName;

  const caseType = getCaseType(rec);
  const datePhrase = getDateLabel() || `ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ± (${reportDateInput.value})`;

  if(caseType === 'ØºÙŠØ§Ø¨'){
    ltTitle.textContent = "Ù…Ø³Ø§Ø¡Ù„Ø© ØºÙŠØ§Ø¨ Ø¹Ù† Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ";
    ltP1.textContent = `Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙˆØ§Ø±Ø¯Ø© Ù…Ù† Ù…Ù†ØµØ© Ø­Ø¶ÙˆØ±ÙŠØŒ ØªÙ… Ø±ØµØ¯ ØºÙŠØ§Ø¨ÙƒÙ… Ø¹Ù† Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ ${datePhrase} Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù….`;
    ltP2.textContent = `ÙˆØ¹Ù„ÙŠÙ‡ Ù†Ø£Ù…Ù„ Ù…Ù†ÙƒÙ… ØªØ²ÙˆÙŠØ¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø¨Ø¥ÙŠØ¶Ø§Ø­ Ø®Ø·ÙŠ Ø¹Ù† Ø³Ø¨Ø¨ Ø§Ù„ØºÙŠØ§Ø¨ØŒ Ù…Ø¹ Ø±ÙØ¹ Ø§Ù„Ø¹Ø°Ø± Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠ (Ø§Ø¶Ø·Ø±Ø§Ø±ÙŠ/Ù…Ø±Ø¶ÙŠ) Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… ÙØ§Ø±Ø³ Ø®Ù„Ø§Ù„ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŒ Ù„ÙŠØªÙ… Ø§Ù„Ù†Ø¸Ø± ÙÙŠÙ‡ ÙˆÙÙ‚ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø¸Ù…Ø©ØŒ Ù…Ø¹ ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ØºÙŠØ§Ø¨ ÙÙŠ Ù…Ù†ØµØ© Ø­Ø¶ÙˆØ±ÙŠ.`;
    ltP3.textContent = `ÙˆÙÙŠ Ø­Ø§Ù„ ØªÙƒØ±Ø§Ø± Ø§Ù„ØºÙŠØ§Ø¨ Ø£Ùˆ Ø¹Ø¯Ù… ØªÙ‚Ø¯ÙŠÙ… Ù…Ø§ ÙŠØ«Ø¨Øª Ø§Ù„Ø¹Ø°Ø± Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ› Ø³ÙŠØªÙ… Ø§Ù„Ø±ÙØ¹ Ù„Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø®ØªØµØ© Ù„Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ù…Ø§ ÙŠÙ„Ø²Ù… ÙˆÙÙ‚ Ø£Ù†Ø¸Ù…Ø© ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ….`;
  }else if(caseType === 'ØªØ£Ø®Ø±'){
    const delayText = formatDelayAr(rec.tardyMinutes);
    ltTitle.textContent = "ØªÙ†Ø¨ÙŠÙ‡ ØªØ£Ø®Ø± Ø¹Ù† Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ";
    ltP1.textContent = `ØªÙÙŠØ¯ÙƒÙ… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø¨Ø£Ù†Ù‡ ØªÙ… Ø±ØµØ¯ ØªØ£Ø®Ø±ÙƒÙ… Ø¹Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ ${datePhrase}ØŒ Ø­ÙŠØ« Ø³ÙØ¬Ù‘ÙÙ„ ÙˆÙ‚Øª Ø­Ø¶ÙˆØ±ÙƒÙ… Ø§Ù„Ø³Ø§Ø¹Ø© (${rec.attend || '--:--'})ØŒ ÙˆØ¨Ù…Ø¯Ø© ØªØ£Ø®ÙŠØ± Ù‚Ø¯Ø±Ù‡Ø§ (${delayText}).`;
    ltP2.textContent = `ÙˆÙ†Ø¤ÙƒØ¯ Ø¹Ù„Ù‰ Ø¶Ø±ÙˆØ±Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©ØŒ ÙˆØªØ­Ø±ÙŠ Ø§Ù„Ø¯Ù‚Ø© ÙÙŠ Ø§Ù„Ø­Ø¶ÙˆØ± ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø› Ø­ÙØ§Ø¸Ù‹Ø§ Ø¹Ù„Ù‰ Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆØ§Ù†ØªØ¸Ø§Ù…Ù‡Ø§.`;
    ltP3.textContent = `ÙˆØ³ÙŠÙØªØ§Ø¨ÙØ¹ ØªÙƒØ±Ø§Ø± Ø§Ù„ØªØ£Ø®Ø± ÙˆÙŠÙØªØ®Ø° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ ÙˆÙÙ‚ ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… ÙÙŠ Ø­Ø§Ù„ Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø°Ù„Ùƒ Ø¯ÙˆÙ† Ù…Ø¨Ø±Ø± Ù…Ù‚Ø¨ÙˆÙ„.`;
  }else if(caseType === 'Ø§Ù†ØµØ±Ø§Ù'){
    const extra = rec.afterTwo ? " Ø£Ùˆ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø© (2:00 Ù…)" : "";
    ltTitle.textContent = "Ù„ÙØª Ù†Ø¸Ø± Ø¨Ø´Ø£Ù† Ø§Ù„Ø§Ù†ØµØ±Ø§Ù ÙˆØ¹Ø¯Ù… Ø¥ÙƒÙ…Ø§Ù„ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¯ÙˆØ§Ù…";
    ltP1.textContent = `ØªÙÙŠØ¯ÙƒÙ… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø¨Ø£Ù†Ù‡ ØªÙ… Ø±ØµØ¯ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø¯ÙˆÙ† Ø§Ø³ØªØ¦Ø°Ø§Ù† Ù†Ø¸Ø§Ù…ÙŠ Ø£Ùˆ Ø¹Ø¯Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù ${datePhrase}ØŒ Ø­ÙŠØ« Ø³ÙØ¬Ù‘ÙÙ„ ÙˆÙ‚Øª Ø­Ø¶ÙˆØ±ÙƒÙ… Ø§Ù„Ø³Ø§Ø¹Ø© (${rec.attend || '--:--'})ØŒ Ù…Ø¹ Ø¹Ø¯Ù… Ø¥ÙƒÙ…Ø§Ù„ Ù…Ø¯Ø© Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø¨Ù€ Ø³Ø¨Ø¹ Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„${extra}.`;
    ltP2.textContent = `ÙˆÙ†Ø¤ÙƒØ¯ Ø£Ù† Ø§Ù„Ø®Ø±ÙˆØ¬ Ù‚Ø¨Ù„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù…ØŒ Ø£Ùˆ Ø¹Ø¯Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù ÙÙŠ Ù…Ù†ØµØ© Ø­Ø¶ÙˆØ±ÙŠØŒ ÙŠØ¹Ø¯ Ù…Ø®Ø§Ù„ÙØ© Ù„Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø¸Ù…Ø© Ù„Ù„Ø¯ÙˆØ§Ù… Ø§Ù„Ø±Ø³Ù…ÙŠ ÙÙŠ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³.`;
    ltP3.textContent = `ÙˆØ³ÙŠÙØªØ§Ø¨ÙØ¹ Ø°Ù„Ùƒ Ù…Ù† Ù‚Ø¨Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©ØŒ ÙˆÙŠÙØªØ®Ø° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ ÙˆÙÙ‚ Ù…Ø§ ØªÙ‚Ø¶ÙŠ Ø¨Ù‡ Ù„ÙˆØ§Ø¦Ø­ ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø¹Ù†Ø¯ ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ø£Ùˆ Ø¹Ø¯Ù… ØªÙ‚Ø¯ÙŠÙ… Ù…Ø¨Ø±Ø± Ù†Ø¸Ø§Ù…ÙŠ Ù…Ù‚Ø¨ÙˆÙ„.`;
  }else{
    ltTitle.textContent = "ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø´Ø£Ù† Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø¯ÙˆØ§Ù…";
    ltP1.textContent = `ØªÙ…Øª Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù ÙÙŠ Ù…Ù†ØµØ© Ø­Ø¶ÙˆØ±ÙŠ ${datePhrase}ØŒ ÙˆØªØ¨ÙŠÙ† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø¯ÙˆØ§Ù….`;
    ltP2.textContent = `ÙˆÙ†Ø¤ÙƒØ¯ Ø¹Ù„Ù‰ Ø£Ù‡Ù…ÙŠØ© Ø§Ù„ØªÙ‚ÙŠØ¯ Ø¨Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©ØŒ Ø¨Ù…Ø§ ÙŠØ¶Ù…Ù† Ø§Ù†ØªØ¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©.`;
    ltP3.textContent = `Ù†Ø£Ù…Ù„ Ù…Ù†ÙƒÙ… Ù…Ø±Ø§Ø¹Ø§Ø© Ø°Ù„Ùƒ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹ØŒ ÙˆØ³ÙŠØªÙ… Ù…ØªØ§Ø¨Ø¹Ø© ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆÙÙ‚ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙˆØ§Ù„Ù„ÙˆØ§Ø¦Ø­ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©.`;
  }

  modalLetter.classList.add('active');
}

// ØªÙ‡ÙŠØ¦Ø©
setStatus('Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯.',false);
</script>
</body>
</html>
